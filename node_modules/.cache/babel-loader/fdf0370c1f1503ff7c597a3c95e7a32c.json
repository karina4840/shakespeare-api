{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.setSuggestionsSearchValue = setSuggestionsSearchValue;\nexports.clearSuggestionsSearchValue = clearSuggestionsSearchValue;\nexports.updateAnalyticsConfig = updateAnalyticsConfig;\nexports.getRecentSearches = getRecentSearches;\nexports.recordResultClick = recordResultClick;\nexports.recordSuggestionClick = recordSuggestionClick;\nexports.recordImpressions = recordImpressions;\n\nvar _constants = require('../constants');\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction setSuggestionsSearchValue(value) {\n  return {\n    type: _constants.SET_SUGGESTIONS_SEARCH_VALUE,\n    value: value\n  };\n}\n\nfunction clearSuggestionsSearchValue() {\n  return {\n    type: _constants.CLEAR_SUGGESTIONS_SEARCH_VALUE\n  };\n}\n\nfunction updateAnalyticsConfig(analyticsConfig) {\n  return {\n    type: _constants.UPDATE_ANALYTICS_CONFIG,\n    analyticsConfig: analyticsConfig\n  };\n}\n\nfunction getRecentSearches() {\n  var queryOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    size: 5,\n    minChars: 3\n  };\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        config = _getState.config,\n        headers = _getState.headers,\n        _getState$appbaseRef = _getState.appbaseRef,\n        url = _getState$appbaseRef.url,\n        protocol = _getState$appbaseRef.protocol,\n        credentials = _getState$appbaseRef.credentials;\n\n    var app = config.app,\n        mongodb = config.mongodb;\n    var esURL = protocol + '://' + url;\n    var parsedURL = (esURL || '').replace(/\\/+$/, '');\n    var requestOptions = {\n      headers: _extends({}, headers, {\n        'Content-Type': 'application/json',\n        Authorization: 'Basic ' + btoa(credentials)\n      })\n    };\n    var queryString = '';\n\n    var addParam = function addParam(key, value) {\n      if (queryString) {\n        queryString += '&' + key + '=' + value;\n      } else {\n        queryString += key + '=' + value;\n      }\n    };\n\n    if (config.analyticsConfig && config.analyticsConfig.userId) {\n      addParam('user_id', config.analyticsConfig.userId);\n    }\n\n    if (queryOptions) {\n      if (queryOptions.size) {\n        addParam('size', String(queryOptions.size));\n      }\n\n      if (queryOptions.from) {\n        addParam('from', queryOptions.from);\n      }\n\n      if (queryOptions.to) {\n        addParam('to', queryOptions.to);\n      }\n\n      if (queryOptions.minChars) {\n        addParam('min_chars', String(queryOptions.minChars));\n      }\n\n      if (queryOptions.customEvents) {\n        Object.keys(queryOptions.customEvents).forEach(function (key) {\n          addParam(key, queryOptions.customEvents[key]);\n        });\n      }\n    }\n\n    if (mongodb) {\n      return dispatch({\n        type: _constants.RECENT_SEARCHES_SUCCESS,\n        data: []\n      });\n    }\n\n    return fetch(parsedURL + '/_analytics/' + app + '/recent-searches?' + queryString, requestOptions).then(function (res) {\n      if (res.status >= 500 || res.status >= 400) {\n        return dispatch({\n          type: _constants.RECENT_SEARCHES_ERROR,\n          error: res\n        });\n      }\n\n      return res.json().then(function (recentSearches) {\n        return dispatch({\n          type: _constants.RECENT_SEARCHES_SUCCESS,\n          data: recentSearches\n        });\n      }).catch(function (e) {\n        return dispatch({\n          type: _constants.RECENT_SEARCHES_ERROR,\n          error: e\n        });\n      });\n    }).catch(function (e) {\n      return dispatch({\n        type: _constants.RECENT_SEARCHES_ERROR,\n        error: e\n      });\n    });\n  };\n}\n\nfunction recordClick(_ref) {\n  var url = _ref.url,\n      app = _ref.app,\n      credentials = _ref.credentials,\n      headers = _ref.headers,\n      documentId = _ref.documentId,\n      clickPosition = _ref.clickPosition,\n      queryId = _ref.queryId,\n      clickType = _ref.clickType;\n\n  if (!documentId) {\n    console.warn('ReactiveSearch: document id is required to record the click analytics');\n  } else {\n    fetch(url + '/' + app + '/_analytics/click', {\n      method: 'PUT',\n      body: JSON.stringify({\n        query_id: queryId,\n        click_type: clickType || 'result',\n        click_on: _defineProperty({}, documentId, clickPosition + 1)\n      }),\n      headers: _extends({}, headers, {\n        'Content-Type': 'application/json',\n        Authorization: 'Basic ' + btoa(credentials)\n      })\n    });\n  }\n}\n\nfunction recordResultClick(searchPosition, documentId) {\n  return function (dispatch, getState) {\n    var _getState2 = getState(),\n        config = _getState2.config,\n        searchId = _getState2.analytics.searchId,\n        headers = _getState2.headers,\n        _getState2$appbaseRef = _getState2.appbaseRef,\n        url = _getState2$appbaseRef.url,\n        protocol = _getState2$appbaseRef.protocol,\n        credentials = _getState2$appbaseRef.credentials;\n\n    var app = config.app;\n    var esURL = protocol + '://' + url;\n\n    if (config.analytics && searchId) {\n      var parsedHeaders = headers;\n      delete parsedHeaders['X-Search-Query'];\n      var parsedURL = (esURL || '').replace(/\\/+$/, '');\n\n      if (parsedURL.includes('scalr.api.appbase.io')) {\n        fetch(parsedURL + '/' + app + '/_analytics', {\n          method: 'POST',\n          headers: _extends({}, parsedHeaders, {\n            'Content-Type': 'application/json',\n            Authorization: 'Basic ' + btoa(credentials),\n            'X-Search-Id': searchId,\n            'X-Search-Click': true,\n            'X-Search-ClickPosition': searchPosition + 1\n          })\n        });\n      } else {\n        recordClick({\n          url: parsedURL,\n          app: app,\n          credentials: credentials,\n          parsedHeaders: parsedHeaders,\n          documentId: documentId,\n          clickPosition: searchPosition,\n          queryId: searchId\n        });\n      }\n    }\n  };\n}\n\nfunction recordSuggestionClick(searchPosition, documentId) {\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        config = _getState3.config,\n        suggestionsSearchId = _getState3.analytics.suggestionsSearchId,\n        headers = _getState3.headers,\n        _getState3$appbaseRef = _getState3.appbaseRef,\n        url = _getState3$appbaseRef.url,\n        protocol = _getState3$appbaseRef.protocol,\n        credentials = _getState3$appbaseRef.credentials;\n\n    var app = config.app;\n    var esURL = protocol + '://' + url;\n\n    if (config.analytics && (config.analyticsConfig === undefined || config.analyticsConfig.suggestionAnalytics === undefined || config.analyticsConfig.suggestionAnalytics) && suggestionsSearchId && searchPosition !== undefined) {\n      var parsedHeaders = headers;\n      delete parsedHeaders['X-Search-Query'];\n      var parsedURL = (esURL || '').replace(/\\/+$/, '');\n\n      if (parsedURL.includes('scalr.api.appbase.io')) {\n        fetch(parsedURL + '/' + app + '/_analytics', {\n          method: 'POST',\n          headers: _extends({}, parsedHeaders, {\n            'Content-Type': 'application/json',\n            Authorization: 'Basic ' + btoa(credentials),\n            'X-Search-Id': suggestionsSearchId,\n            'X-Search-Suggestions-Click': true,\n            'X-Search-Suggestions-ClickPosition': searchPosition + 1\n          })\n        });\n      } else {\n        recordClick({\n          url: parsedURL,\n          app: app,\n          credentials: credentials,\n          parsedHeaders: parsedHeaders,\n          documentId: documentId,\n          clickPosition: searchPosition,\n          clickType: 'suggestion',\n          queryId: suggestionsSearchId\n        });\n      }\n    }\n  };\n}\n\nfunction recordImpressions(queryId) {\n  var impressions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return function (dispatch, getState) {\n    var _getState4 = getState(),\n        app = _getState4.config.app,\n        headers = _getState4.headers,\n        _getState4$appbaseRef = _getState4.appbaseRef,\n        url = _getState4$appbaseRef.url,\n        protocol = _getState4$appbaseRef.protocol,\n        credentials = _getState4$appbaseRef.credentials;\n\n    var esURL = protocol + '://' + url;\n    var parsedURL = esURL.replace(/\\/+$/, '');\n\n    if (!parsedURL.includes('scalr.api.appbase.io') && queryId && impressions.length) {\n      fetch(parsedURL + '/' + app + '/_analytics/search', {\n        method: 'PUT',\n        body: JSON.stringify({\n          query_id: queryId,\n          impressions: impressions\n        }),\n        keepalive: true,\n        headers: _extends({}, headers, {\n          'Content-Type': 'application/json',\n          Authorization: 'Basic ' + btoa(credentials)\n        })\n      });\n    }\n  };\n}","map":{"version":3,"sources":["/Users/karina/Main/Study/Web Dev/test-api/node_modules/@appbaseio/reactivecore/lib/actions/analytics.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","setSuggestionsSearchValue","clearSuggestionsSearchValue","updateAnalyticsConfig","getRecentSearches","recordResultClick","recordSuggestionClick","recordImpressions","_constants","require","_defineProperty","obj","enumerable","configurable","writable","type","SET_SUGGESTIONS_SEARCH_VALUE","CLEAR_SUGGESTIONS_SEARCH_VALUE","analyticsConfig","UPDATE_ANALYTICS_CONFIG","queryOptions","undefined","size","minChars","dispatch","getState","_getState","config","headers","_getState$appbaseRef","appbaseRef","url","protocol","credentials","app","mongodb","esURL","parsedURL","replace","requestOptions","Authorization","btoa","queryString","addParam","userId","String","from","to","customEvents","keys","forEach","RECENT_SEARCHES_SUCCESS","data","fetch","then","res","status","RECENT_SEARCHES_ERROR","error","json","recentSearches","catch","e","recordClick","_ref","documentId","clickPosition","queryId","clickType","console","warn","method","body","JSON","stringify","query_id","click_type","click_on","searchPosition","_getState2","searchId","analytics","_getState2$appbaseRef","parsedHeaders","includes","_getState3","suggestionsSearchId","_getState3$appbaseRef","suggestionAnalytics","impressions","_getState4","_getState4$appbaseRef","keepalive"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.setSuggestionsSearchValue=setSuggestionsSearchValue;exports.clearSuggestionsSearchValue=clearSuggestionsSearchValue;exports.updateAnalyticsConfig=updateAnalyticsConfig;exports.getRecentSearches=getRecentSearches;exports.recordResultClick=recordResultClick;exports.recordSuggestionClick=recordSuggestionClick;exports.recordImpressions=recordImpressions;var _constants=require('../constants');function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function setSuggestionsSearchValue(value){return{type:_constants.SET_SUGGESTIONS_SEARCH_VALUE,value:value};}function clearSuggestionsSearchValue(){return{type:_constants.CLEAR_SUGGESTIONS_SEARCH_VALUE};}function updateAnalyticsConfig(analyticsConfig){return{type:_constants.UPDATE_ANALYTICS_CONFIG,analyticsConfig:analyticsConfig};}function getRecentSearches(){var queryOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{size:5,minChars:3};return function(dispatch,getState){var _getState=getState(),config=_getState.config,headers=_getState.headers,_getState$appbaseRef=_getState.appbaseRef,url=_getState$appbaseRef.url,protocol=_getState$appbaseRef.protocol,credentials=_getState$appbaseRef.credentials;var app=config.app,mongodb=config.mongodb;var esURL=protocol+'://'+url;var parsedURL=(esURL||'').replace(/\\/+$/,'');var requestOptions={headers:_extends({},headers,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials)})};var queryString='';var addParam=function addParam(key,value){if(queryString){queryString+='&'+key+'='+value;}else{queryString+=key+'='+value;}};if(config.analyticsConfig&&config.analyticsConfig.userId){addParam('user_id',config.analyticsConfig.userId);}if(queryOptions){if(queryOptions.size){addParam('size',String(queryOptions.size));}if(queryOptions.from){addParam('from',queryOptions.from);}if(queryOptions.to){addParam('to',queryOptions.to);}if(queryOptions.minChars){addParam('min_chars',String(queryOptions.minChars));}if(queryOptions.customEvents){Object.keys(queryOptions.customEvents).forEach(function(key){addParam(key,queryOptions.customEvents[key]);});}}if(mongodb){return dispatch({type:_constants.RECENT_SEARCHES_SUCCESS,data:[]});}return fetch(parsedURL+'/_analytics/'+app+'/recent-searches?'+queryString,requestOptions).then(function(res){if(res.status>=500||res.status>=400){return dispatch({type:_constants.RECENT_SEARCHES_ERROR,error:res});}return res.json().then(function(recentSearches){return dispatch({type:_constants.RECENT_SEARCHES_SUCCESS,data:recentSearches});}).catch(function(e){return dispatch({type:_constants.RECENT_SEARCHES_ERROR,error:e});});}).catch(function(e){return dispatch({type:_constants.RECENT_SEARCHES_ERROR,error:e});});};}function recordClick(_ref){var url=_ref.url,app=_ref.app,credentials=_ref.credentials,headers=_ref.headers,documentId=_ref.documentId,clickPosition=_ref.clickPosition,queryId=_ref.queryId,clickType=_ref.clickType;if(!documentId){console.warn('ReactiveSearch: document id is required to record the click analytics');}else{fetch(url+'/'+app+'/_analytics/click',{method:'PUT',body:JSON.stringify({query_id:queryId,click_type:clickType||'result',click_on:_defineProperty({},documentId,clickPosition+1)}),headers:_extends({},headers,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials)})});}}function recordResultClick(searchPosition,documentId){return function(dispatch,getState){var _getState2=getState(),config=_getState2.config,searchId=_getState2.analytics.searchId,headers=_getState2.headers,_getState2$appbaseRef=_getState2.appbaseRef,url=_getState2$appbaseRef.url,protocol=_getState2$appbaseRef.protocol,credentials=_getState2$appbaseRef.credentials;var app=config.app;var esURL=protocol+'://'+url;if(config.analytics&&searchId){var parsedHeaders=headers;delete parsedHeaders['X-Search-Query'];var parsedURL=(esURL||'').replace(/\\/+$/,'');if(parsedURL.includes('scalr.api.appbase.io')){fetch(parsedURL+'/'+app+'/_analytics',{method:'POST',headers:_extends({},parsedHeaders,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials),'X-Search-Id':searchId,'X-Search-Click':true,'X-Search-ClickPosition':searchPosition+1})});}else{recordClick({url:parsedURL,app:app,credentials:credentials,parsedHeaders:parsedHeaders,documentId:documentId,clickPosition:searchPosition,queryId:searchId});}}};}function recordSuggestionClick(searchPosition,documentId){return function(dispatch,getState){var _getState3=getState(),config=_getState3.config,suggestionsSearchId=_getState3.analytics.suggestionsSearchId,headers=_getState3.headers,_getState3$appbaseRef=_getState3.appbaseRef,url=_getState3$appbaseRef.url,protocol=_getState3$appbaseRef.protocol,credentials=_getState3$appbaseRef.credentials;var app=config.app;var esURL=protocol+'://'+url;if(config.analytics&&(config.analyticsConfig===undefined||config.analyticsConfig.suggestionAnalytics===undefined||config.analyticsConfig.suggestionAnalytics)&&suggestionsSearchId&&searchPosition!==undefined){var parsedHeaders=headers;delete parsedHeaders['X-Search-Query'];var parsedURL=(esURL||'').replace(/\\/+$/,'');if(parsedURL.includes('scalr.api.appbase.io')){fetch(parsedURL+'/'+app+'/_analytics',{method:'POST',headers:_extends({},parsedHeaders,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials),'X-Search-Id':suggestionsSearchId,'X-Search-Suggestions-Click':true,'X-Search-Suggestions-ClickPosition':searchPosition+1})});}else{recordClick({url:parsedURL,app:app,credentials:credentials,parsedHeaders:parsedHeaders,documentId:documentId,clickPosition:searchPosition,clickType:'suggestion',queryId:suggestionsSearchId});}}};}function recordImpressions(queryId){var impressions=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return function(dispatch,getState){var _getState4=getState(),app=_getState4.config.app,headers=_getState4.headers,_getState4$appbaseRef=_getState4.appbaseRef,url=_getState4$appbaseRef.url,protocol=_getState4$appbaseRef.protocol,credentials=_getState4$appbaseRef.credentials;var esURL=protocol+'://'+url;var parsedURL=esURL.replace(/\\/+$/,'');if(!parsedURL.includes('scalr.api.appbase.io')&&queryId&&impressions.length){fetch(parsedURL+'/'+app+'/_analytics/search',{method:'PUT',body:JSON.stringify({query_id:queryId,impressions:impressions}),keepalive:true,headers:_extends({},headers,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials)})});}};}"]},"metadata":{},"sourceType":"script"}