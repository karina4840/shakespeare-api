{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.loadPopularSuggestions = loadPopularSuggestions;\nexports.executeQuery = executeQuery;\nexports.setQueryOptions = setQueryOptions;\nexports.updateQuery = updateQuery;\nexports.loadMore = loadMore;\n\nvar _value = require('./value');\n\nvar _utils = require('./utils');\n\nvar _misc = require('./misc');\n\nvar _helper = require('../utils/helper');\n\nvar _analytics = require('../utils/analytics');\n\nvar _analytics2 = _interopRequireDefault(_analytics);\n\nvar _maps = require('./maps');\n\nvar _graphQL = require('../utils/graphQL');\n\nvar _graphQL2 = _interopRequireDefault(_graphQL);\n\nvar _constants = require('../utils/constants');\n\nvar _transform = require('../utils/transform');\n\nvar _transform2 = require('../../lib/utils/transform');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction loadPopularSuggestions(componentId) {\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        config = _getState.config,\n        appbaseRef = _getState.appbaseRef,\n        props = _getState.props,\n        internalValues = _getState.internalValues;\n\n    var isAppbaseEnabled = config && config.enableAppbase;\n    var componentProps = props[componentId] || {};\n    var internalValue = internalValues[componentId];\n    var value = internalValue && internalValue.value || '';\n\n    if (isAppbaseEnabled && (componentProps.enablePopularSuggestions || componentProps.enableQuerySuggestions)) {\n      if (config.mongodb) {\n        dispatch((0, _misc.setDefaultPopularSuggestions)([], componentId.split('__internal')[0]));\n        return;\n      }\n\n      var suggQuery = (0, _utils.getSuggestionQuery)(getState, componentId);\n      appbaseRef.getQuerySuggestions(suggQuery).then(function (suggestions) {\n        var querySuggestion = suggestions[(0, _utils.getQuerySuggestionsId)(componentId)];\n\n        if (value) {\n          dispatch((0, _misc.setPopularSuggestions)(querySuggestion && querySuggestion.hits && querySuggestion.hits.hits, componentId.split('__internal')[0]));\n        } else {\n          dispatch((0, _misc.setDefaultPopularSuggestions)(querySuggestion && querySuggestion.hits && querySuggestion.hits.hits, componentId.split('__internal')[0]));\n        }\n      }).catch(function (e) {\n        (0, _utils.handleError)({\n          orderOfQueries: [componentId],\n          error: e\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nvar handleTransformRequest = function handleTransformRequest(transformRequest, res) {\n  if (transformRequest && typeof transformRequest === 'function') {\n    var transformRequestPromise = transformRequest(res);\n    return transformRequestPromise instanceof Promise ? transformRequestPromise : Promise.resolve(transformRequestPromise);\n  }\n\n  return Promise.resolve(res);\n};\n\nfunction msearch(query, orderOfQueries) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var isInternalComponent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var appendToAggs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var componentType = arguments[5];\n  return function (dispatch, getState) {\n    var _getState2 = getState(),\n        appbaseRef = _getState2.appbaseRef,\n        config = _getState2.config,\n        headers = _getState2.headers,\n        analytics = _getState2.analytics,\n        selectedValues = _getState2.selectedValues;\n\n    var searchHeaders = {};\n    var suggestionsComponents = [_constants.componentTypes.dataSearch, _constants.componentTypes.categorySearch];\n    var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n\n    if (config.analytics) {\n      if (config.analyticsConfig.suggestionAnalytics && isSuggestionsQuery) {\n        var suggestionsSearchValue = analytics.suggestionsSearchValue;\n        var shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || suggestionsSearchValue);\n\n        if (shouldIncludeQuery) {\n          searchHeaders = {\n            'X-Search-Query': suggestionsSearchValue || ''\n          };\n        }\n      } else {\n        var searchValue = analytics.searchValue,\n            searchId = analytics.searchId;\n        var filterString = (0, _analytics2.default)(selectedValues);\n\n        if (searchId) {\n          searchHeaders = _extends({\n            'X-Search-Id': searchId,\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        } else {\n          var _shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || searchValue);\n\n          searchHeaders = _extends(_shouldIncludeQuery && {\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        }\n      }\n\n      if (config.analyticsConfig.userId) {\n        searchHeaders['X-User-Id'] = config.analyticsConfig.userId;\n      }\n\n      if (config.analyticsConfig.customEvents) {\n        searchHeaders['X-Search-CustomEvent'] = (0, _analytics.parseCustomEvents)(config.analyticsConfig.customEvents);\n      }\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n\n    if (config.graphQLUrl) {\n      var requestOptions = {\n        graphQLUrl: config.graphQLUrl,\n        url: config.url,\n        credentials: config.credentials,\n        app: config.app,\n        query: query,\n        headers: headers\n      };\n      handleTransformRequest(appbaseRef.transformRequest, requestOptions).then(function (modifiedRequest) {\n        (0, _graphQL2.default)(modifiedRequest).then(function (res) {\n          (0, _utils.handleResponseMSearch)({\n            res: res,\n            isSuggestionsQuery: isSuggestionsQuery,\n            orderOfQueries: orderOfQueries,\n            appendToHits: appendToHits,\n            appendToAggs: appendToAggs\n          }, getState, dispatch);\n        }).catch(function (err) {\n          (0, _utils.handleError)({\n            orderOfQueries: orderOfQueries,\n            error: err\n          }, getState, dispatch);\n        });\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    } else {\n      appbaseRef.setHeaders(_extends({}, headers, searchHeaders));\n      appbaseRef.msearch({\n        type: config.type === '*' ? '' : config.type,\n        body: query\n      }).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nfunction appbaseSearch() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      query = _ref.query,\n      orderOfQueries = _ref.orderOfQueries,\n      _ref$appendToHits = _ref.appendToHits,\n      appendToHits = _ref$appendToHits === undefined ? false : _ref$appendToHits,\n      _ref$isSuggestionsQue = _ref.isSuggestionsQuery,\n      isSuggestionsQuery = _ref$isSuggestionsQue === undefined ? false : _ref$isSuggestionsQue,\n      searchComponentID = _ref.searchComponentID,\n      _ref$appendToAggs = _ref.appendToAggs,\n      appendToAggs = _ref$appendToAggs === undefined ? false : _ref$appendToAggs;\n\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        appbaseRef = _getState3.appbaseRef,\n        config = _getState3.config,\n        headers = _getState3.headers;\n\n    var isAnalyticsEnabled = false;\n\n    if (config) {\n      if ((0, _utils.isPropertyDefined)(config.analytics)) {\n        isAnalyticsEnabled = config.analytics;\n      } else if (config.analyticsConfig) {\n        if ((0, _utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.recordAnalytics;\n        } else if ((0, _utils.isPropertyDefined)(config.analyticsConfig.analytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.analytics;\n        }\n      }\n    }\n\n    var settings = {\n      recordAnalytics: isAnalyticsEnabled\n    };\n\n    if (config.analyticsConfig) {\n      settings.userId = (0, _utils.isPropertyDefined)(config.analyticsConfig.userId) ? config.analyticsConfig.userId : undefined;\n      settings.enableQueryRules = (0, _utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules) ? config.analyticsConfig.enableQueryRules : undefined;\n      settings.customEvents = (0, _utils.isPropertyDefined)(config.analyticsConfig.customEvents) ? config.analyticsConfig.customEvents : undefined;\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n    appbaseRef.setHeaders(_extends({}, headers));\n\n    if (isSuggestionsQuery && searchComponentID) {\n      dispatch(loadPopularSuggestions(searchComponentID));\n    }\n\n    appbaseRef.reactiveSearchv3(query, settings).then(function (res) {\n      (0, _utils.handleResponse)({\n        res: res,\n        orderOfQueries: orderOfQueries,\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs\n      }, getState, dispatch);\n    }).catch(function (err) {\n      (0, _utils.handleError)({\n        orderOfQueries: orderOfQueries,\n        error: err\n      }, getState, dispatch);\n    });\n  };\n}\n\nvar requestStack = [];\nvar lock = false;\n\nfunction executeQuery(componentId) {\n  var executeWatchList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var mustExecuteMapQuery = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var componentType = arguments[3];\n  var metaOptions = arguments[4];\n  return function (dispatch, getState) {\n    var _getState4 = getState(),\n        queryLog = _getState4.queryLog,\n        config = _getState4.config,\n        mapData = _getState4.mapData,\n        watchMan = _getState4.watchMan,\n        dependencyTree = _getState4.dependencyTree,\n        queryList = _getState4.queryList,\n        queryOptions = _getState4.queryOptions,\n        queryListener = _getState4.queryListener,\n        props = _getState4.props,\n        selectedValues = _getState4.selectedValues,\n        internalValues = _getState4.internalValues;\n\n    var lockTime = config.initialQueriesSyncTime;\n    var initialTimestamp = config.initialTimestamp;\n    var componentList = [componentId];\n    var finalQuery = [];\n    var appbaseQuery = {};\n    var orderOfQueries = [];\n    var isAppbaseEnabled = config && config.enableAppbase;\n\n    if (executeWatchList) {\n      var watchList = watchMan[componentId] || [];\n      componentList = [].concat(_toConsumableArray(componentList), _toConsumableArray(watchList));\n    }\n\n    var matchAllQuery = {\n      match_all: {}\n    };\n    componentList.forEach(function (component) {\n      var componentProps = props[component];\n\n      if (selectedValues[componentId] && selectedValues[componentId].reference !== 'URL' && componentProps && [_constants.componentTypes.reactiveList, _constants.componentTypes.reactiveMap].includes(componentProps.componentType)) {\n        dispatch((0, _value.setValue)(component, null));\n      }\n\n      var _buildQuery = (0, _helper.buildQuery)(component, dependencyTree, queryList, queryOptions),\n          queryObj = _buildQuery.queryObj,\n          options = _buildQuery.options;\n\n      var validOptions = ['aggs', 'from', 'sort'];\n\n      if (queryObj && !!Object.keys(queryObj).length || options && Object.keys(options).some(function (item) {\n        return validOptions.includes(item);\n      })) {\n        if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n          queryObj = _extends({}, matchAllQuery);\n        }\n\n        var currentQuery = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var queryToLog = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var oldQuery = queryLog[component];\n\n        if (mustExecuteMapQuery || !(0, _helper.isEqual)(currentQuery, oldQuery)) {\n          orderOfQueries = [].concat(_toConsumableArray(orderOfQueries), [component]);\n          dispatch((0, _misc.logQuery)(component, queryToLog));\n          var isMapComponent = Object.keys(mapData).includes(component);\n\n          if (isMapComponent && mapData[component].query) {\n            var existingQuery = currentQuery.query;\n            currentQuery.query = {\n              bool: {\n                must: [existingQuery, mapData[component].query]\n              }\n            };\n\n            if (!mapData[component].persistMapQuery) {\n              dispatch((0, _maps.updateMapData)(componentId, null, false));\n            }\n\n            var _getState5 = getState(),\n                combinedLog = _getState5.combinedLog;\n\n            if ((0, _helper.isEqual)(combinedLog[component], currentQuery)) return;\n            dispatch((0, _misc.logCombinedQuery)(component, currentQuery));\n          }\n\n          (0, _utils.executeQueryListener)(queryListener[component], oldQuery, currentQuery);\n\n          if (isAppbaseEnabled) {\n            var value = void 0;\n            var isInternalComponent = componentId.endsWith('__internal');\n            var mainComponentProps = props[componentId];\n\n            if (isInternalComponent && mainComponentProps && (0, _transform.isSearchComponent)(mainComponentProps.componentType)) {\n              value = internalValues[componentId] && internalValues[componentId].value;\n            }\n\n            var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(getState(), component, _extends({}, value ? {\n              value: value\n            } : null, metaOptions ? {\n              from: metaOptions.from\n            } : null)));\n\n            if (query) {\n              appbaseQuery = _extends({}, appbaseQuery, _defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, orderOfQueries));\n            }\n\n            if (isMapComponent) {\n              var internalComponent = (0, _transform2.getInternalComponentID)(component);\n              var internalQuery = (0, _transform.getRSQuery)(internalComponent, (0, _transform.extractPropsFromState)(getState(), internalComponent, metaOptions ? {\n                from: metaOptions.from\n              } : null));\n\n              if (internalQuery) {\n                appbaseQuery[internalComponent] = _extends({}, internalQuery, {\n                  execute: false\n                });\n              }\n            }\n          } else {\n            var preference = config && config.analyticsConfig && config.analyticsConfig.userId ? config.analyticsConfig.userId + '_' + component : component;\n            finalQuery = [].concat(_toConsumableArray(finalQuery), [{\n              preference: preference\n            }, currentQuery]);\n          }\n        }\n      }\n    });\n\n    if (isAppbaseEnabled) {\n      finalQuery = Object.keys(appbaseQuery).map(function (component) {\n        return appbaseQuery[component];\n      });\n    }\n\n    if (finalQuery.length) {\n      if (isAppbaseEnabled) {\n        var suggestionsComponents = [_constants.componentTypes.dataSearch, _constants.componentTypes.categorySearch];\n        var isInternalComponent = componentId.endsWith('__internal');\n        var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n        var currentTime = new Date().getTime();\n\n        if (currentTime - initialTimestamp < lockTime) {\n          if (!lock) {\n            setTimeout(function () {\n              var finalOrderOfQueries = [];\n              var finalIsSuggestionsQuery = false;\n              var finalSearchComponentID = '';\n              var orderOfQueriesMap = {};\n              var processedQueriesMap = {};\n              var queryExecutionMap = {};\n              requestStack.forEach(function (request) {\n                if (!finalIsSuggestionsQuery) {\n                  finalIsSuggestionsQuery = request.isSuggestionsQuery;\n                }\n\n                if (!finalSearchComponentID) {\n                  finalSearchComponentID = request.searchComponentID;\n                }\n\n                if (Array.isArray(request.query)) {\n                  request.query.forEach(function (query) {\n                    if (query.execute) {\n                      queryExecutionMap[query.id] = query.execute;\n                    }\n\n                    var newQuery = query;\n\n                    if (queryExecutionMap[query.id]) {\n                      newQuery.execute = true;\n                    }\n\n                    processedQueriesMap[query.id] = newQuery;\n                  });\n                }\n\n                if (Array.isArray(request.orderOfQueries)) {\n                  request.orderOfQueries.forEach(function (query) {\n                    if (!orderOfQueriesMap[query.id]) {\n                      finalOrderOfQueries = [query].concat(_toConsumableArray(finalOrderOfQueries));\n                    } else {\n                      orderOfQueriesMap[query.id] = true;\n                    }\n                  });\n                }\n              });\n              var finalCombinedQuery = Object.values(processedQueriesMap);\n\n              if (finalCombinedQuery.length) {\n                dispatch(appbaseSearch({\n                  query: finalCombinedQuery,\n                  orderOfQueries: finalOrderOfQueries,\n                  isSuggestionsQuery: finalIsSuggestionsQuery,\n                  searchComponentID: finalSearchComponentID\n                }));\n              }\n\n              requestStack = [];\n            }, lockTime);\n          }\n\n          lock = true;\n          requestStack.push({\n            query: finalQuery,\n            orderOfQueries: orderOfQueries,\n            isSuggestionsQuery: isSuggestionsQuery,\n            searchComponentID: componentId\n          });\n        } else {\n          dispatch(appbaseSearch({\n            query: finalQuery,\n            orderOfQueries: orderOfQueries,\n            isSuggestionsQuery: isSuggestionsQuery,\n            searchComponentID: componentId\n          }));\n        }\n      } else {\n        dispatch(msearch(finalQuery, orderOfQueries, false, componentId.endsWith('__internal'), undefined, componentType));\n      }\n    }\n  };\n}\n\nfunction setQueryOptions(component, queryOptions) {\n  var execute = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (dispatch) {\n    dispatch((0, _misc.updateQueryOptions)(component, queryOptions));\n\n    if (execute) {\n      dispatch(executeQuery(component, true));\n    }\n  };\n}\n\nfunction updateQuery(_ref2) {\n  var componentId = _ref2.componentId,\n      query = _ref2.query,\n      value = _ref2.value,\n      _ref2$label = _ref2.label,\n      label = _ref2$label === undefined ? null : _ref2$label,\n      _ref2$showFilter = _ref2.showFilter,\n      showFilter = _ref2$showFilter === undefined ? true : _ref2$showFilter,\n      _ref2$URLParams = _ref2.URLParams,\n      URLParams = _ref2$URLParams === undefined ? false : _ref2$URLParams,\n      _ref2$componentType = _ref2.componentType,\n      componentType = _ref2$componentType === undefined ? null : _ref2$componentType,\n      _ref2$category = _ref2.category,\n      category = _ref2$category === undefined ? null : _ref2$category,\n      _ref2$meta = _ref2.meta,\n      meta = _ref2$meta === undefined ? {} : _ref2$meta;\n  var execute = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (dispatch) {\n    var queryToDispatch = query;\n\n    if (query && query.query) {\n      queryToDispatch = query.query;\n    }\n\n    if (!componentId.endsWith('__internal')) {\n      dispatch((0, _value.setValue)(componentId, value, label, showFilter, URLParams, componentType, category, meta));\n\n      if (componentType === _constants.componentTypes.dynamicRangeSlider) {\n        dispatch((0, _value.setInternalValue)((0, _transform.getHistogramComponentID)(componentId), value, componentType, category, meta));\n      } else {\n        dispatch((0, _value.setInternalValue)(componentId + '__internal', value, componentType, category, meta));\n      }\n    } else {\n      dispatch((0, _value.setInternalValue)(componentId, value, componentType, category, meta));\n    }\n\n    dispatch((0, _misc.setQuery)(componentId, queryToDispatch));\n    if (execute) dispatch(executeQuery(componentId, true, false, componentType));\n  };\n}\n\nfunction loadMore(component, newOptions) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var appendToAggs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch, getState) {\n    var store = getState();\n\n    var _buildQuery2 = (0, _helper.buildQuery)(component, store.dependencyTree, store.queryList, store.queryOptions),\n        queryObj = _buildQuery2.queryObj,\n        options = _buildQuery2.options;\n\n    var queryLog = store.queryLog;\n    if (!options) options = {};\n    options = _extends({}, options, newOptions);\n\n    if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n      queryObj = {\n        match_all: {}\n      };\n    }\n\n    var currentQuery = _extends({\n      query: _extends({}, queryObj)\n    }, options);\n\n    if ((0, _helper.isEqual)(queryLog[component], currentQuery)) return;\n    dispatch((0, _misc.logQuery)(component, currentQuery));\n\n    if (store.config && store.config.enableAppbase) {\n      var appbaseQuery = {};\n      var componentProps = store.props[component] || {};\n      var compositeAggregationField = componentProps.aggregationField;\n      var queryType = _transform.componentToTypeMap[componentProps.componentType];\n\n      if (queryType === _constants.queryTypes.term) {\n        compositeAggregationField = componentProps.dataField;\n      }\n\n      var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(store, component, {\n        from: options.from,\n        after: store.aggregations[component] && store.aggregations[component][compositeAggregationField] && store.aggregations[component][compositeAggregationField].after_key || undefined\n      }));\n      appbaseQuery = _extends(_defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, []));\n      var finalQuery = Object.keys(appbaseQuery).map(function (c) {\n        return appbaseQuery[c];\n      });\n      dispatch(appbaseSearch({\n        query: finalQuery,\n        orderOfQueries: [component],\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs\n      }));\n    } else {\n      var preference = store.config && store.config.analyticsConfig && store.config.analyticsConfig.userId ? store.config.analyticsConfig.userId + '_' + component : component;\n      var _finalQuery = [{\n        preference: preference\n      }, currentQuery];\n      dispatch(msearch(_finalQuery, [component], appendToHits, false, appendToAggs));\n    }\n  };\n}","map":{"version":3,"sources":["/Users/karina/Main/Study/Web Dev/test-api/node_modules/@appbaseio/reactivecore/lib/actions/query.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","loadPopularSuggestions","executeQuery","setQueryOptions","updateQuery","loadMore","_value","require","_utils","_misc","_helper","_analytics","_analytics2","_interopRequireDefault","_maps","_graphQL","_graphQL2","_constants","_transform","_transform2","obj","__esModule","default","_defineProperty","enumerable","configurable","writable","_toConsumableArray","arr","Array","isArray","arr2","from","componentId","dispatch","getState","_getState","config","appbaseRef","props","internalValues","isAppbaseEnabled","enableAppbase","componentProps","internalValue","enablePopularSuggestions","enableQuerySuggestions","mongodb","setDefaultPopularSuggestions","split","suggQuery","getSuggestionQuery","getQuerySuggestions","then","suggestions","querySuggestion","getQuerySuggestionsId","setPopularSuggestions","hits","catch","e","handleError","orderOfQueries","error","handleTransformRequest","transformRequest","res","transformRequestPromise","Promise","resolve","msearch","query","appendToHits","undefined","isInternalComponent","appendToAggs","componentType","_getState2","headers","analytics","selectedValues","searchHeaders","suggestionsComponents","componentTypes","dataSearch","categorySearch","isSuggestionsQuery","indexOf","analyticsConfig","suggestionAnalytics","suggestionsSearchValue","shouldIncludeQuery","emptyQuery","searchValue","searchId","filterString","_shouldIncludeQuery","userId","customEvents","parseCustomEvents","forEach","component","setLoading","setError","graphQLUrl","requestOptions","url","credentials","app","modifiedRequest","handleResponseMSearch","err","setHeaders","type","body","appbaseSearch","_ref","_ref$appendToHits","_ref$isSuggestionsQue","searchComponentID","_ref$appendToAggs","_getState3","isAnalyticsEnabled","isPropertyDefined","recordAnalytics","settings","enableQueryRules","reactiveSearchv3","handleResponse","requestStack","lock","executeWatchList","mustExecuteMapQuery","metaOptions","_getState4","queryLog","mapData","watchMan","dependencyTree","queryList","queryOptions","queryListener","lockTime","initialQueriesSyncTime","initialTimestamp","componentList","finalQuery","appbaseQuery","watchList","concat","matchAllQuery","match_all","reference","reactiveList","reactiveMap","includes","setValue","_buildQuery","buildQuery","queryObj","options","validOptions","keys","some","item","currentQuery","queryToLog","oldQuery","isEqual","logQuery","isMapComponent","existingQuery","bool","must","persistMapQuery","updateMapData","_getState5","combinedLog","logCombinedQuery","executeQueryListener","endsWith","mainComponentProps","isSearchComponent","getRSQuery","extractPropsFromState","getDependentQueries","internalComponent","getInternalComponentID","internalQuery","execute","preference","map","currentTime","Date","getTime","setTimeout","finalOrderOfQueries","finalIsSuggestionsQuery","finalSearchComponentID","orderOfQueriesMap","processedQueriesMap","queryExecutionMap","request","id","newQuery","finalCombinedQuery","values","push","updateQueryOptions","_ref2","_ref2$label","label","_ref2$showFilter","showFilter","_ref2$URLParams","URLParams","_ref2$componentType","_ref2$category","category","_ref2$meta","meta","queryToDispatch","dynamicRangeSlider","setInternalValue","getHistogramComponentID","setQuery","newOptions","store","_buildQuery2","compositeAggregationField","aggregationField","queryType","componentToTypeMap","queryTypes","term","dataField","after","aggregations","after_key","c","_finalQuery"],"mappings":"AAAAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA8B,YAA9B,EAA2C;AAACC,EAAAA,KAAK,EAAC;AAAP,CAA3C;;AAAyD,IAAIC,QAAQ,GAACJ,MAAM,CAACK,MAAP,IAAe,UAASC,MAAT,EAAgB;AAAC,OAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACC,SAAS,CAACC,MAAxB,EAA+BF,CAAC,EAAhC,EAAmC;AAAC,QAAIG,MAAM,GAACF,SAAS,CAACD,CAAD,CAApB;;AAAwB,SAAI,IAAII,GAAR,IAAeD,MAAf,EAAsB;AAAC,UAAGV,MAAM,CAACY,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,MAArC,EAA4CC,GAA5C,CAAH,EAAoD;AAACL,QAAAA,MAAM,CAACK,GAAD,CAAN,GAAYD,MAAM,CAACC,GAAD,CAAlB;AAAyB;AAAC;AAAC;;AAAA,SAAOL,MAAP;AAAe,CAA/N;;AAAgOJ,OAAO,CAACa,sBAAR,GAA+BA,sBAA/B;AAAsDb,OAAO,CAACc,YAAR,GAAqBA,YAArB;AAAkCd,OAAO,CAACe,eAAR,GAAwBA,eAAxB;AAAwCf,OAAO,CAACgB,WAAR,GAAoBA,WAApB;AAAgChB,OAAO,CAACiB,QAAR,GAAiBA,QAAjB;;AAA0B,IAAIC,MAAM,GAACC,OAAO,CAAC,SAAD,CAAlB;;AAA8B,IAAIC,MAAM,GAACD,OAAO,CAAC,SAAD,CAAlB;;AAA8B,IAAIE,KAAK,GAACF,OAAO,CAAC,QAAD,CAAjB;;AAA4B,IAAIG,OAAO,GAACH,OAAO,CAAC,iBAAD,CAAnB;;AAAuC,IAAII,UAAU,GAACJ,OAAO,CAAC,oBAAD,CAAtB;;AAA6C,IAAIK,WAAW,GAACC,sBAAsB,CAACF,UAAD,CAAtC;;AAAmD,IAAIG,KAAK,GAACP,OAAO,CAAC,QAAD,CAAjB;;AAA4B,IAAIQ,QAAQ,GAACR,OAAO,CAAC,kBAAD,CAApB;;AAAyC,IAAIS,SAAS,GAACH,sBAAsB,CAACE,QAAD,CAApC;;AAA+C,IAAIE,UAAU,GAACV,OAAO,CAAC,oBAAD,CAAtB;;AAA6C,IAAIW,UAAU,GAACX,OAAO,CAAC,oBAAD,CAAtB;;AAA6C,IAAIY,WAAW,GAACZ,OAAO,CAAC,2BAAD,CAAvB;;AAAqD,SAASM,sBAAT,CAAgCO,GAAhC,EAAoC;AAAC,SAAOA,GAAG,IAAEA,GAAG,CAACC,UAAT,GAAoBD,GAApB,GAAwB;AAACE,IAAAA,OAAO,EAACF;AAAT,GAA/B;AAA8C;;AAAA,SAASG,eAAT,CAAyBH,GAAzB,EAA6BvB,GAA7B,EAAiCR,KAAjC,EAAuC;AAAC,MAAGQ,GAAG,IAAIuB,GAAV,EAAc;AAAClC,IAAAA,MAAM,CAACC,cAAP,CAAsBiC,GAAtB,EAA0BvB,GAA1B,EAA8B;AAACR,MAAAA,KAAK,EAACA,KAAP;AAAamC,MAAAA,UAAU,EAAC,IAAxB;AAA6BC,MAAAA,YAAY,EAAC,IAA1C;AAA+CC,MAAAA,QAAQ,EAAC;AAAxD,KAA9B;AAA8F,GAA7G,MAAiH;AAACN,IAAAA,GAAG,CAACvB,GAAD,CAAH,GAASR,KAAT;AAAgB;;AAAA,SAAO+B,GAAP;AAAY;;AAAA,SAASO,kBAAT,CAA4BC,GAA5B,EAAgC;AAAC,MAAGC,KAAK,CAACC,OAAN,CAAcF,GAAd,CAAH,EAAsB;AAAC,SAAI,IAAInC,CAAC,GAAC,CAAN,EAAQsC,IAAI,GAACF,KAAK,CAACD,GAAG,CAACjC,MAAL,CAAtB,EAAmCF,CAAC,GAACmC,GAAG,CAACjC,MAAzC,EAAgDF,CAAC,EAAjD,EAAoD;AAACsC,MAAAA,IAAI,CAACtC,CAAD,CAAJ,GAAQmC,GAAG,CAACnC,CAAD,CAAX;AAAgB;;AAAA,WAAOsC,IAAP;AAAa,GAAzG,MAA6G;AAAC,WAAOF,KAAK,CAACG,IAAN,CAAWJ,GAAX,CAAP;AAAwB;AAAC;;AAAA,SAAS3B,sBAAT,CAAgCgC,WAAhC,EAA4C;AAAC,SAAO,UAASC,QAAT,EAAkBC,QAAlB,EAA2B;AAAC,QAAIC,SAAS,GAACD,QAAQ,EAAtB;AAAA,QAAyBE,MAAM,GAACD,SAAS,CAACC,MAA1C;AAAA,QAAiDC,UAAU,GAACF,SAAS,CAACE,UAAtE;AAAA,QAAiFC,KAAK,GAACH,SAAS,CAACG,KAAjG;AAAA,QAAuGC,cAAc,GAACJ,SAAS,CAACI,cAAhI;;AAA+I,QAAIC,gBAAgB,GAACJ,MAAM,IAAEA,MAAM,CAACK,aAApC;AAAkD,QAAIC,cAAc,GAACJ,KAAK,CAACN,WAAD,CAAL,IAAoB,EAAvC;AAA0C,QAAIW,aAAa,GAACJ,cAAc,CAACP,WAAD,CAAhC;AAA8C,QAAI5C,KAAK,GAACuD,aAAa,IAAEA,aAAa,CAACvD,KAA7B,IAAoC,EAA9C;;AAAiD,QAAGoD,gBAAgB,KAAGE,cAAc,CAACE,wBAAf,IAAyCF,cAAc,CAACG,sBAA3D,CAAnB,EAAsG;AAAC,UAAGT,MAAM,CAACU,OAAV,EAAkB;AAACb,QAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACuC,4BAAT,EAAuC,EAAvC,EAA0Cf,WAAW,CAACgB,KAAZ,CAAkB,YAAlB,EAAgC,CAAhC,CAA1C,CAAD,CAAR;AAAwF;AAAQ;;AAAA,UAAIC,SAAS,GAAC,CAAC,GAAE1C,MAAM,CAAC2C,kBAAV,EAA8BhB,QAA9B,EAAuCF,WAAvC,CAAd;AAAkEK,MAAAA,UAAU,CAACc,mBAAX,CAA+BF,SAA/B,EAA0CG,IAA1C,CAA+C,UAASC,WAAT,EAAqB;AAAC,YAAIC,eAAe,GAACD,WAAW,CAAC,CAAC,GAAE9C,MAAM,CAACgD,qBAAV,EAAiCvB,WAAjC,CAAD,CAA/B;;AAA+E,YAAG5C,KAAH,EAAS;AAAC6C,UAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACgD,qBAAT,EAAgCF,eAAe,IAAEA,eAAe,CAACG,IAAjC,IAAuCH,eAAe,CAACG,IAAhB,CAAqBA,IAA5F,EAAiGzB,WAAW,CAACgB,KAAZ,CAAkB,YAAlB,EAAgC,CAAhC,CAAjG,CAAD,CAAR;AAAgJ,SAA1J,MAA8J;AAACf,UAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACuC,4BAAT,EAAuCO,eAAe,IAAEA,eAAe,CAACG,IAAjC,IAAuCH,eAAe,CAACG,IAAhB,CAAqBA,IAAnG,EAAwGzB,WAAW,CAACgB,KAAZ,CAAkB,YAAlB,EAAgC,CAAhC,CAAxG,CAAD,CAAR;AAAuJ;AAAC,OAA3c,EAA6cU,KAA7c,CAAmd,UAASC,CAAT,EAAW;AAAC,SAAC,GAAEpD,MAAM,CAACqD,WAAV,EAAuB;AAACC,UAAAA,cAAc,EAAC,CAAC7B,WAAD,CAAhB;AAA8B8B,UAAAA,KAAK,EAACH;AAApC,SAAvB,EAA8DzB,QAA9D,EAAuED,QAAvE;AAAkF,OAAjjB;AAAojB;AAAC,GAA9rC;AAAgsC;;AAAA,IAAI8B,sBAAsB,GAAC,SAASA,sBAAT,CAAgCC,gBAAhC,EAAiDC,GAAjD,EAAqD;AAAC,MAAGD,gBAAgB,IAAE,OAAOA,gBAAP,KAA0B,UAA/C,EAA0D;AAAC,QAAIE,uBAAuB,GAACF,gBAAgB,CAACC,GAAD,CAA5C;AAAkD,WAAOC,uBAAuB,YAAYC,OAAnC,GAA2CD,uBAA3C,GAAmEC,OAAO,CAACC,OAAR,CAAgBF,uBAAhB,CAA1E;AAAoH;;AAAA,SAAOC,OAAO,CAACC,OAAR,CAAgBH,GAAhB,CAAP;AAA6B,CAA/U;;AAAgV,SAASI,OAAT,CAAiBC,KAAjB,EAAuBT,cAAvB,EAAsC;AAAC,MAAIU,YAAY,GAAC9E,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,KAA3E;AAAiF,MAAIgF,mBAAmB,GAAChF,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,KAAlF;AAAwF,MAAIiF,YAAY,GAACjF,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,KAA3E;AAAiF,MAAIkF,aAAa,GAAClF,SAAS,CAAC,CAAD,CAA3B;AAA+B,SAAO,UAASwC,QAAT,EAAkBC,QAAlB,EAA2B;AAAC,QAAI0C,UAAU,GAAC1C,QAAQ,EAAvB;AAAA,QAA0BG,UAAU,GAACuC,UAAU,CAACvC,UAAhD;AAAA,QAA2DD,MAAM,GAACwC,UAAU,CAACxC,MAA7E;AAAA,QAAoFyC,OAAO,GAACD,UAAU,CAACC,OAAvG;AAAA,QAA+GC,SAAS,GAACF,UAAU,CAACE,SAApI;AAAA,QAA8IC,cAAc,GAACH,UAAU,CAACG,cAAxK;;AAAuL,QAAIC,aAAa,GAAC,EAAlB;AAAqB,QAAIC,qBAAqB,GAAC,CAACjE,UAAU,CAACkE,cAAX,CAA0BC,UAA3B,EAAsCnE,UAAU,CAACkE,cAAX,CAA0BE,cAAhE,CAA1B;AAA0G,QAAIC,kBAAkB,GAACZ,mBAAmB,IAAEQ,qBAAqB,CAACK,OAAtB,CAA8BX,aAA9B,MAA+C,CAAC,CAA5F;;AAA8F,QAAGvC,MAAM,CAAC0C,SAAV,EAAoB;AAAC,UAAG1C,MAAM,CAACmD,eAAP,CAAuBC,mBAAvB,IAA4CH,kBAA/C,EAAkE;AAAC,YAAII,sBAAsB,GAACX,SAAS,CAACW,sBAArC;AAA4D,YAAIC,kBAAkB,GAAC,CAAC,EAAEtD,MAAM,CAACmD,eAAP,CAAuBI,UAAvB,IAAmCF,sBAArC,CAAxB;;AAAqF,YAAGC,kBAAH,EAAsB;AAACV,UAAAA,aAAa,GAAC;AAAC,8BAAiBS,sBAAsB,IAAE;AAA1C,WAAd;AAA6D;AAAC,OAAzS,MAA6S;AAAC,YAAIG,WAAW,GAACd,SAAS,CAACc,WAA1B;AAAA,YAAsCC,QAAQ,GAACf,SAAS,CAACe,QAAzD;AAAkE,YAAIC,YAAY,GAAC,CAAC,GAAEnF,WAAW,CAACU,OAAf,EAAwB0D,cAAxB,CAAjB;;AAAyD,YAAGc,QAAH,EAAY;AAACb,UAAAA,aAAa,GAAC3F,QAAQ,CAAC;AAAC,2BAAcwG,QAAf;AAAwB,8BAAiBD,WAAW,IAAE;AAAtD,WAAD,EAA2DE,YAAY,IAAE;AAAC,gCAAmBA;AAApB,WAAzE,CAAtB;AAAmI,SAAhJ,MAAoJ;AAAC,cAAIC,mBAAmB,GAAC,CAAC,EAAE3D,MAAM,CAACmD,eAAP,CAAuBI,UAAvB,IAAmCC,WAArC,CAAzB;;AAA2EZ,UAAAA,aAAa,GAAC3F,QAAQ,CAAC0G,mBAAmB,IAAE;AAAC,8BAAiBH,WAAW,IAAE;AAA/B,WAAtB,EAAyDE,YAAY,IAAE;AAAC,gCAAmBA;AAApB,WAAvE,CAAtB;AAAiI;AAAC;;AAAA,UAAG1D,MAAM,CAACmD,eAAP,CAAuBS,MAA1B,EAAiC;AAAChB,QAAAA,aAAa,CAAC,WAAD,CAAb,GAA2B5C,MAAM,CAACmD,eAAP,CAAuBS,MAAlD;AAA0D;;AAAA,UAAG5D,MAAM,CAACmD,eAAP,CAAuBU,YAA1B,EAAuC;AAACjB,QAAAA,aAAa,CAAC,sBAAD,CAAb,GAAsC,CAAC,GAAEtE,UAAU,CAACwF,iBAAd,EAAiC9D,MAAM,CAACmD,eAAP,CAAuBU,YAAxD,CAAtC;AAA6G;AAAC;;AAAApC,IAAAA,cAAc,CAACsC,OAAf,CAAuB,UAASC,SAAT,EAAmB;AAACnE,MAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAAC6F,UAAT,EAAqBD,SAArB,EAA+B,IAA/B,CAAD,CAAR;AAA+CnE,MAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAAC8F,QAAT,EAAmBF,SAAnB,EAA6B,IAA7B,CAAD,CAAR;AAA8C,KAAxI;;AAA0I,QAAGhE,MAAM,CAACmE,UAAV,EAAqB;AAAC,UAAIC,cAAc,GAAC;AAACD,QAAAA,UAAU,EAACnE,MAAM,CAACmE,UAAnB;AAA8BE,QAAAA,GAAG,EAACrE,MAAM,CAACqE,GAAzC;AAA6CC,QAAAA,WAAW,EAACtE,MAAM,CAACsE,WAAhE;AAA4EC,QAAAA,GAAG,EAACvE,MAAM,CAACuE,GAAvF;AAA2FrC,QAAAA,KAAK,EAACA,KAAjG;AAAuGO,QAAAA,OAAO,EAACA;AAA/G,OAAnB;AAA2Id,MAAAA,sBAAsB,CAAC1B,UAAU,CAAC2B,gBAAZ,EAA6BwC,cAA7B,CAAtB,CAAmEpD,IAAnE,CAAwE,UAASwD,eAAT,EAAyB;AAAC,SAAC,GAAE7F,SAAS,CAACM,OAAb,EAAsBuF,eAAtB,EAAuCxD,IAAvC,CAA4C,UAASa,GAAT,EAAa;AAAC,WAAC,GAAE1D,MAAM,CAACsG,qBAAV,EAAiC;AAAC5C,YAAAA,GAAG,EAACA,GAAL;AAASoB,YAAAA,kBAAkB,EAACA,kBAA5B;AAA+CxB,YAAAA,cAAc,EAACA,cAA9D;AAA6EU,YAAAA,YAAY,EAACA,YAA1F;AAAuGG,YAAAA,YAAY,EAACA;AAApH,WAAjC,EAAmKxC,QAAnK,EAA4KD,QAA5K;AAAuL,SAAjP,EAAmPyB,KAAnP,CAAyP,UAASoD,GAAT,EAAa;AAAC,WAAC,GAAEvG,MAAM,CAACqD,WAAV,EAAuB;AAACC,YAAAA,cAAc,EAACA,cAAhB;AAA+BC,YAAAA,KAAK,EAACgD;AAArC,WAAvB,EAAiE5E,QAAjE,EAA0ED,QAA1E;AAAqF,SAA5V;AAA+V,OAAjc,EAAmcyB,KAAnc,CAAyc,UAASoD,GAAT,EAAa;AAAC,SAAC,GAAEvG,MAAM,CAACqD,WAAV,EAAuB;AAACC,UAAAA,cAAc,EAACA,cAAhB;AAA+BC,UAAAA,KAAK,EAACgD;AAArC,SAAvB,EAAiE5E,QAAjE,EAA0ED,QAA1E;AAAqF,OAA5iB;AAA+iB,KAAhtB,MAAotB;AAACI,MAAAA,UAAU,CAAC0E,UAAX,CAAsB1H,QAAQ,CAAC,EAAD,EAAIwF,OAAJ,EAAYG,aAAZ,CAA9B;AAA0D3C,MAAAA,UAAU,CAACgC,OAAX,CAAmB;AAAC2C,QAAAA,IAAI,EAAC5E,MAAM,CAAC4E,IAAP,KAAc,GAAd,GAAkB,EAAlB,GAAqB5E,MAAM,CAAC4E,IAAlC;AAAuCC,QAAAA,IAAI,EAAC3C;AAA5C,OAAnB,EAAuElB,IAAvE,CAA4E,UAASa,GAAT,EAAa;AAAC,SAAC,GAAE1D,MAAM,CAACsG,qBAAV,EAAiC;AAAC5C,UAAAA,GAAG,EAACA,GAAL;AAASoB,UAAAA,kBAAkB,EAACA,kBAA5B;AAA+CxB,UAAAA,cAAc,EAACA,cAA9D;AAA6EU,UAAAA,YAAY,EAACA,YAA1F;AAAuGG,UAAAA,YAAY,EAACA;AAApH,SAAjC,EAAmKxC,QAAnK,EAA4KD,QAA5K;AAAuL,OAAjR,EAAmRyB,KAAnR,CAAyR,UAASoD,GAAT,EAAa;AAAC,SAAC,GAAEvG,MAAM,CAACqD,WAAV,EAAuB;AAACC,UAAAA,cAAc,EAACA,cAAhB;AAA+BC,UAAAA,KAAK,EAACgD;AAArC,SAAvB,EAAiE5E,QAAjE,EAA0ED,QAA1E;AAAqF,OAA5X;AAA+X;AAAC,GAAluF;AAAouF;;AAAA,SAASiF,aAAT,GAAwB;AAAC,MAAIC,IAAI,GAAC1H,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,EAAnE;AAAA,MAAsE6E,KAAK,GAAC6C,IAAI,CAAC7C,KAAjF;AAAA,MAAuFT,cAAc,GAACsD,IAAI,CAACtD,cAA3G;AAAA,MAA0HuD,iBAAiB,GAACD,IAAI,CAAC5C,YAAjJ;AAAA,MAA8JA,YAAY,GAAC6C,iBAAiB,KAAG5C,SAApB,GAA8B,KAA9B,GAAoC4C,iBAA/M;AAAA,MAAiOC,qBAAqB,GAACF,IAAI,CAAC9B,kBAA5P;AAAA,MAA+QA,kBAAkB,GAACgC,qBAAqB,KAAG7C,SAAxB,GAAkC,KAAlC,GAAwC6C,qBAA1U;AAAA,MAAgWC,iBAAiB,GAACH,IAAI,CAACG,iBAAvX;AAAA,MAAyYC,iBAAiB,GAACJ,IAAI,CAACzC,YAAha;AAAA,MAA6aA,YAAY,GAAC6C,iBAAiB,KAAG/C,SAApB,GAA8B,KAA9B,GAAoC+C,iBAA9d;;AAAgf,SAAO,UAAStF,QAAT,EAAkBC,QAAlB,EAA2B;AAAC,QAAIsF,UAAU,GAACtF,QAAQ,EAAvB;AAAA,QAA0BG,UAAU,GAACmF,UAAU,CAACnF,UAAhD;AAAA,QAA2DD,MAAM,GAACoF,UAAU,CAACpF,MAA7E;AAAA,QAAoFyC,OAAO,GAAC2C,UAAU,CAAC3C,OAAvG;;AAA+G,QAAI4C,kBAAkB,GAAC,KAAvB;;AAA6B,QAAGrF,MAAH,EAAU;AAAC,UAAG,CAAC,GAAE7B,MAAM,CAACmH,iBAAV,EAA6BtF,MAAM,CAAC0C,SAApC,CAAH,EAAkD;AAAC2C,QAAAA,kBAAkB,GAACrF,MAAM,CAAC0C,SAA1B;AAAqC,OAAxF,MAA6F,IAAG1C,MAAM,CAACmD,eAAV,EAA0B;AAAC,YAAG,CAAC,GAAEhF,MAAM,CAACmH,iBAAV,EAA6BtF,MAAM,CAACmD,eAAP,CAAuBoC,eAApD,CAAH,EAAwE;AAACF,UAAAA,kBAAkB,GAACrF,MAAM,CAACmD,eAAP,CAAuBoC,eAA1C;AAA2D,SAApI,MAAyI,IAAG,CAAC,GAAEpH,MAAM,CAACmH,iBAAV,EAA6BtF,MAAM,CAACmD,eAAP,CAAuBT,SAApD,CAAH,EAAkE;AAAC2C,UAAAA,kBAAkB,GAACrF,MAAM,CAACmD,eAAP,CAAuBT,SAA1C;AAAqD;AAAC;AAAC;;AAAA,QAAI8C,QAAQ,GAAC;AAACD,MAAAA,eAAe,EAACF;AAAjB,KAAb;;AAAkD,QAAGrF,MAAM,CAACmD,eAAV,EAA0B;AAACqC,MAAAA,QAAQ,CAAC5B,MAAT,GAAgB,CAAC,GAAEzF,MAAM,CAACmH,iBAAV,EAA6BtF,MAAM,CAACmD,eAAP,CAAuBS,MAApD,IAA4D5D,MAAM,CAACmD,eAAP,CAAuBS,MAAnF,GAA0FxB,SAA1G;AAAoHoD,MAAAA,QAAQ,CAACC,gBAAT,GAA0B,CAAC,GAAEtH,MAAM,CAACmH,iBAAV,EAA6BtF,MAAM,CAACmD,eAAP,CAAuBsC,gBAApD,IAAsEzF,MAAM,CAACmD,eAAP,CAAuBsC,gBAA7F,GAA8GrD,SAAxI;AAAkJoD,MAAAA,QAAQ,CAAC3B,YAAT,GAAsB,CAAC,GAAE1F,MAAM,CAACmH,iBAAV,EAA6BtF,MAAM,CAACmD,eAAP,CAAuBU,YAApD,IAAkE7D,MAAM,CAACmD,eAAP,CAAuBU,YAAzF,GAAsGzB,SAA5H;AAAuI;;AAAAX,IAAAA,cAAc,CAACsC,OAAf,CAAuB,UAASC,SAAT,EAAmB;AAACnE,MAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAAC6F,UAAT,EAAqBD,SAArB,EAA+B,IAA/B,CAAD,CAAR;AAA+CnE,MAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAAC8F,QAAT,EAAmBF,SAAnB,EAA6B,IAA7B,CAAD,CAAR;AAA8C,KAAxI;AAA0I/D,IAAAA,UAAU,CAAC0E,UAAX,CAAsB1H,QAAQ,CAAC,EAAD,EAAIwF,OAAJ,CAA9B;;AAA4C,QAAGQ,kBAAkB,IAAEiC,iBAAvB,EAAyC;AAACrF,MAAAA,QAAQ,CAACjC,sBAAsB,CAACsH,iBAAD,CAAvB,CAAR;AAAqD;;AAAAjF,IAAAA,UAAU,CAACyF,gBAAX,CAA4BxD,KAA5B,EAAkCsD,QAAlC,EAA4CxE,IAA5C,CAAiD,UAASa,GAAT,EAAa;AAAC,OAAC,GAAE1D,MAAM,CAACwH,cAAV,EAA0B;AAAC9D,QAAAA,GAAG,EAACA,GAAL;AAASJ,QAAAA,cAAc,EAACA,cAAxB;AAAuCU,QAAAA,YAAY,EAACA,YAApD;AAAiEG,QAAAA,YAAY,EAACA;AAA9E,OAA1B,EAAsHxC,QAAtH,EAA+HD,QAA/H;AAA0I,KAAzM,EAA2MyB,KAA3M,CAAiN,UAASoD,GAAT,EAAa;AAAC,OAAC,GAAEvG,MAAM,CAACqD,WAAV,EAAuB;AAACC,QAAAA,cAAc,EAACA,cAAhB;AAA+BC,QAAAA,KAAK,EAACgD;AAArC,OAAvB,EAAiE5E,QAAjE,EAA0ED,QAA1E;AAAqF,KAApT;AAAuT,GAA3lD;AAA6lD;;AAAA,IAAI+F,YAAY,GAAC,EAAjB;AAAoB,IAAIC,IAAI,GAAC,KAAT;;AAAe,SAAShI,YAAT,CAAsB+B,WAAtB,EAAkC;AAAC,MAAIkG,gBAAgB,GAACzI,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,KAA/E;AAAqF,MAAI0I,mBAAmB,GAAC1I,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,KAAlF;AAAwF,MAAIkF,aAAa,GAAClF,SAAS,CAAC,CAAD,CAA3B;AAA+B,MAAI2I,WAAW,GAAC3I,SAAS,CAAC,CAAD,CAAzB;AAA6B,SAAO,UAASwC,QAAT,EAAkBC,QAAlB,EAA2B;AAAC,QAAImG,UAAU,GAACnG,QAAQ,EAAvB;AAAA,QAA0BoG,QAAQ,GAACD,UAAU,CAACC,QAA9C;AAAA,QAAuDlG,MAAM,GAACiG,UAAU,CAACjG,MAAzE;AAAA,QAAgFmG,OAAO,GAACF,UAAU,CAACE,OAAnG;AAAA,QAA2GC,QAAQ,GAACH,UAAU,CAACG,QAA/H;AAAA,QAAwIC,cAAc,GAACJ,UAAU,CAACI,cAAlK;AAAA,QAAiLC,SAAS,GAACL,UAAU,CAACK,SAAtM;AAAA,QAAgNC,YAAY,GAACN,UAAU,CAACM,YAAxO;AAAA,QAAqPC,aAAa,GAACP,UAAU,CAACO,aAA9Q;AAAA,QAA4RtG,KAAK,GAAC+F,UAAU,CAAC/F,KAA7S;AAAA,QAAmTyC,cAAc,GAACsD,UAAU,CAACtD,cAA7U;AAAA,QAA4VxC,cAAc,GAAC8F,UAAU,CAAC9F,cAAtX;;AAAqY,QAAIsG,QAAQ,GAACzG,MAAM,CAAC0G,sBAApB;AAA2C,QAAIC,gBAAgB,GAAC3G,MAAM,CAAC2G,gBAA5B;AAA6C,QAAIC,aAAa,GAAC,CAAChH,WAAD,CAAlB;AAAgC,QAAIiH,UAAU,GAAC,EAAf;AAAkB,QAAIC,YAAY,GAAC,EAAjB;AAAoB,QAAIrF,cAAc,GAAC,EAAnB;AAAsB,QAAIrB,gBAAgB,GAACJ,MAAM,IAAEA,MAAM,CAACK,aAApC;;AAAkD,QAAGyF,gBAAH,EAAoB;AAAC,UAAIiB,SAAS,GAACX,QAAQ,CAACxG,WAAD,CAAR,IAAuB,EAArC;AAAwCgH,MAAAA,aAAa,GAAC,GAAGI,MAAH,CAAU1H,kBAAkB,CAACsH,aAAD,CAA5B,EAA4CtH,kBAAkB,CAACyH,SAAD,CAA9D,CAAd;AAA0F;;AAAA,QAAIE,aAAa,GAAC;AAACC,MAAAA,SAAS,EAAC;AAAX,KAAlB;AAAiCN,IAAAA,aAAa,CAAC7C,OAAd,CAAsB,UAASC,SAAT,EAAmB;AAAC,UAAI1D,cAAc,GAACJ,KAAK,CAAC8D,SAAD,CAAxB;;AAAoC,UAAGrB,cAAc,CAAC/C,WAAD,CAAd,IAA6B+C,cAAc,CAAC/C,WAAD,CAAd,CAA4BuH,SAA5B,KAAwC,KAArE,IAA4E7G,cAA5E,IAA4F,CAAC1B,UAAU,CAACkE,cAAX,CAA0BsE,YAA3B,EAAwCxI,UAAU,CAACkE,cAAX,CAA0BuE,WAAlE,EAA+EC,QAA/E,CAAwFhH,cAAc,CAACiC,aAAvG,CAA/F,EAAqN;AAAC1C,QAAAA,QAAQ,CAAC,CAAC,GAAE5B,MAAM,CAACsJ,QAAV,EAAoBvD,SAApB,EAA8B,IAA9B,CAAD,CAAR;AAA+C;;AAAA,UAAIwD,WAAW,GAAC,CAAC,GAAEnJ,OAAO,CAACoJ,UAAX,EAAuBzD,SAAvB,EAAiCqC,cAAjC,EAAgDC,SAAhD,EAA0DC,YAA1D,CAAhB;AAAA,UAAwFmB,QAAQ,GAACF,WAAW,CAACE,QAA7G;AAAA,UAAsHC,OAAO,GAACH,WAAW,CAACG,OAA1I;;AAAkJ,UAAIC,YAAY,GAAC,CAAC,MAAD,EAAQ,MAAR,EAAe,MAAf,CAAjB;;AAAwC,UAAGF,QAAQ,IAAE,CAAC,CAAC7K,MAAM,CAACgL,IAAP,CAAYH,QAAZ,EAAsBpK,MAAlC,IAA0CqK,OAAO,IAAE9K,MAAM,CAACgL,IAAP,CAAYF,OAAZ,EAAqBG,IAArB,CAA0B,UAASC,IAAT,EAAc;AAAC,eAAOH,YAAY,CAACN,QAAb,CAAsBS,IAAtB,CAAP;AAAoC,OAA7E,CAAtD,EAAqI;AAAC,YAAG,CAACL,QAAD,IAAWA,QAAQ,IAAE,CAAC7K,MAAM,CAACgL,IAAP,CAAYH,QAAZ,EAAsBpK,MAA/C,EAAsD;AAACoK,UAAAA,QAAQ,GAACzK,QAAQ,CAAC,EAAD,EAAIgK,aAAJ,CAAjB;AAAqC;;AAAA,YAAIe,YAAY,GAAC/K,QAAQ,CAAC;AAACiF,UAAAA,KAAK,EAACjF,QAAQ,CAAC,EAAD,EAAIyK,QAAJ;AAAf,SAAD,EAA+BC,OAA/B,EAAuCpB,YAAY,CAACvC,SAAD,CAAnD,CAAzB;;AAAyF,YAAIiE,UAAU,GAAChL,QAAQ,CAAC;AAACiF,UAAAA,KAAK,EAACjF,QAAQ,CAAC,EAAD,EAAIyK,QAAJ;AAAf,SAAD,EAA+BC,OAA/B,EAAuCpB,YAAY,CAACvC,SAAD,CAAnD,CAAvB;;AAAuF,YAAIkE,QAAQ,GAAChC,QAAQ,CAAClC,SAAD,CAArB;;AAAiC,YAAG+B,mBAAmB,IAAE,CAAC,CAAC,GAAE1H,OAAO,CAAC8J,OAAX,EAAoBH,YAApB,EAAiCE,QAAjC,CAAzB,EAAoE;AAACzG,UAAAA,cAAc,GAAC,GAAGuF,MAAH,CAAU1H,kBAAkB,CAACmC,cAAD,CAA5B,EAA6C,CAACuC,SAAD,CAA7C,CAAf;AAAyEnE,UAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACgK,QAAT,EAAmBpE,SAAnB,EAA6BiE,UAA7B,CAAD,CAAR;AAAmD,cAAII,cAAc,GAACxL,MAAM,CAACgL,IAAP,CAAY1B,OAAZ,EAAqBmB,QAArB,CAA8BtD,SAA9B,CAAnB;;AAA4D,cAAGqE,cAAc,IAAElC,OAAO,CAACnC,SAAD,CAAP,CAAmB9B,KAAtC,EAA4C;AAAC,gBAAIoG,aAAa,GAACN,YAAY,CAAC9F,KAA/B;AAAqC8F,YAAAA,YAAY,CAAC9F,KAAb,GAAmB;AAACqG,cAAAA,IAAI,EAAC;AAACC,gBAAAA,IAAI,EAAC,CAACF,aAAD,EAAenC,OAAO,CAACnC,SAAD,CAAP,CAAmB9B,KAAlC;AAAN;AAAN,aAAnB;;AAA0E,gBAAG,CAACiE,OAAO,CAACnC,SAAD,CAAP,CAAmByE,eAAvB,EAAuC;AAAC5I,cAAAA,QAAQ,CAAC,CAAC,GAAEpB,KAAK,CAACiK,aAAT,EAAwB9I,WAAxB,EAAoC,IAApC,EAAyC,KAAzC,CAAD,CAAR;AAA2D;;AAAA,gBAAI+I,UAAU,GAAC7I,QAAQ,EAAvB;AAAA,gBAA0B8I,WAAW,GAACD,UAAU,CAACC,WAAjD;;AAA6D,gBAAG,CAAC,GAAEvK,OAAO,CAAC8J,OAAX,EAAoBS,WAAW,CAAC5E,SAAD,CAA/B,EAA2CgE,YAA3C,CAAH,EAA4D;AAAOnI,YAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACyK,gBAAT,EAA2B7E,SAA3B,EAAqCgE,YAArC,CAAD,CAAR;AAA8D;;AAAA,WAAC,GAAE7J,MAAM,CAAC2K,oBAAV,EAAgCtC,aAAa,CAACxC,SAAD,CAA7C,EAAyDkE,QAAzD,EAAkEF,YAAlE;;AAAgF,cAAG5H,gBAAH,EAAoB;AAAC,gBAAIpD,KAAK,GAAC,KAAK,CAAf;AAAiB,gBAAIqF,mBAAmB,GAACzC,WAAW,CAACmJ,QAAZ,CAAqB,YAArB,CAAxB;AAA2D,gBAAIC,kBAAkB,GAAC9I,KAAK,CAACN,WAAD,CAA5B;;AAA0C,gBAAGyC,mBAAmB,IAAE2G,kBAArB,IAAyC,CAAC,GAAEnK,UAAU,CAACoK,iBAAd,EAAiCD,kBAAkB,CAACzG,aAApD,CAA5C,EAA+G;AAACvF,cAAAA,KAAK,GAACmD,cAAc,CAACP,WAAD,CAAd,IAA6BO,cAAc,CAACP,WAAD,CAAd,CAA4B5C,KAA/D;AAAsE;;AAAA,gBAAIkF,KAAK,GAAC,CAAC,GAAErD,UAAU,CAACqK,UAAd,EAA0BlF,SAA1B,EAAoC,CAAC,GAAEnF,UAAU,CAACsK,qBAAd,EAAqCrJ,QAAQ,EAA7C,EAAgDkE,SAAhD,EAA0D/G,QAAQ,CAAC,EAAD,EAAID,KAAK,GAAC;AAACA,cAAAA,KAAK,EAACA;AAAP,aAAD,GAAe,IAAxB,EAA6BgJ,WAAW,GAAC;AAACrG,cAAAA,IAAI,EAACqG,WAAW,CAACrG;AAAlB,aAAD,GAAyB,IAAjE,CAAlE,CAApC,CAAV;;AAAyL,gBAAGuC,KAAH,EAAS;AAAC4E,cAAAA,YAAY,GAAC7J,QAAQ,CAAC,EAAD,EAAI6J,YAAJ,EAAiB5H,eAAe,CAAC,EAAD,EAAI8E,SAAJ,EAAc9B,KAAd,CAAhC,EAAqD,CAAC,GAAErD,UAAU,CAACuK,mBAAd,EAAmCtJ,QAAQ,EAA3C,EAA8CkE,SAA9C,EAAwDvC,cAAxD,CAArD,CAArB;AAAoJ;;AAAA,gBAAG4G,cAAH,EAAkB;AAAC,kBAAIgB,iBAAiB,GAAC,CAAC,GAAEvK,WAAW,CAACwK,sBAAf,EAAuCtF,SAAvC,CAAtB;AAAwE,kBAAIuF,aAAa,GAAC,CAAC,GAAE1K,UAAU,CAACqK,UAAd,EAA0BG,iBAA1B,EAA4C,CAAC,GAAExK,UAAU,CAACsK,qBAAd,EAAqCrJ,QAAQ,EAA7C,EAAgDuJ,iBAAhD,EAAkErD,WAAW,GAAC;AAACrG,gBAAAA,IAAI,EAACqG,WAAW,CAACrG;AAAlB,eAAD,GAAyB,IAAtG,CAA5C,CAAlB;;AAA2K,kBAAG4J,aAAH,EAAiB;AAACzC,gBAAAA,YAAY,CAACuC,iBAAD,CAAZ,GAAgCpM,QAAQ,CAAC,EAAD,EAAIsM,aAAJ,EAAkB;AAACC,kBAAAA,OAAO,EAAC;AAAT,iBAAlB,CAAxC;AAA4E;AAAC;AAAC,WAA9/B,MAAkgC;AAAC,gBAAIC,UAAU,GAACzJ,MAAM,IAAEA,MAAM,CAACmD,eAAf,IAAgCnD,MAAM,CAACmD,eAAP,CAAuBS,MAAvD,GAA8D5D,MAAM,CAACmD,eAAP,CAAuBS,MAAvB,GAA8B,GAA9B,GAAkCI,SAAhG,GAA0GA,SAAzH;AAAmI6C,YAAAA,UAAU,GAAC,GAAGG,MAAH,CAAU1H,kBAAkB,CAACuH,UAAD,CAA5B,EAAyC,CAAC;AAAC4C,cAAAA,UAAU,EAACA;AAAZ,aAAD,EAAyBzB,YAAzB,CAAzC,CAAX;AAA6F;AAAC;AAAC;AAAC,KAAh7F;;AAAk7F,QAAG5H,gBAAH,EAAoB;AAACyG,MAAAA,UAAU,GAAChK,MAAM,CAACgL,IAAP,CAAYf,YAAZ,EAA0B4C,GAA1B,CAA8B,UAAS1F,SAAT,EAAmB;AAAC,eAAO8C,YAAY,CAAC9C,SAAD,CAAnB;AAAgC,OAAlF,CAAX;AAAgG;;AAAA,QAAG6C,UAAU,CAACvJ,MAAd,EAAqB;AAAC,UAAG8C,gBAAH,EAAoB;AAAC,YAAIyC,qBAAqB,GAAC,CAACjE,UAAU,CAACkE,cAAX,CAA0BC,UAA3B,EAAsCnE,UAAU,CAACkE,cAAX,CAA0BE,cAAhE,CAA1B;AAA0G,YAAIX,mBAAmB,GAACzC,WAAW,CAACmJ,QAAZ,CAAqB,YAArB,CAAxB;AAA2D,YAAI9F,kBAAkB,GAACZ,mBAAmB,IAAEQ,qBAAqB,CAACK,OAAtB,CAA8BX,aAA9B,MAA+C,CAAC,CAA5F;AAA8F,YAAIoH,WAAW,GAAC,IAAIC,IAAJ,GAAWC,OAAX,EAAhB;;AAAqC,YAAGF,WAAW,GAAChD,gBAAZ,GAA6BF,QAAhC,EAAyC;AAAC,cAAG,CAACZ,IAAJ,EAAS;AAACiE,YAAAA,UAAU,CAAC,YAAU;AAAC,kBAAIC,mBAAmB,GAAC,EAAxB;AAA2B,kBAAIC,uBAAuB,GAAC,KAA5B;AAAkC,kBAAIC,sBAAsB,GAAC,EAA3B;AAA8B,kBAAIC,iBAAiB,GAAC,EAAtB;AAAyB,kBAAIC,mBAAmB,GAAC,EAAxB;AAA2B,kBAAIC,iBAAiB,GAAC,EAAtB;AAAyBxE,cAAAA,YAAY,CAAC7B,OAAb,CAAqB,UAASsG,OAAT,EAAiB;AAAC,oBAAG,CAACL,uBAAJ,EAA4B;AAACA,kBAAAA,uBAAuB,GAACK,OAAO,CAACpH,kBAAhC;AAAoD;;AAAA,oBAAG,CAACgH,sBAAJ,EAA2B;AAACA,kBAAAA,sBAAsB,GAACI,OAAO,CAACnF,iBAA/B;AAAkD;;AAAA,oBAAG1F,KAAK,CAACC,OAAN,CAAc4K,OAAO,CAACnI,KAAtB,CAAH,EAAgC;AAACmI,kBAAAA,OAAO,CAACnI,KAAR,CAAc6B,OAAd,CAAsB,UAAS7B,KAAT,EAAe;AAAC,wBAAGA,KAAK,CAACsH,OAAT,EAAiB;AAACY,sBAAAA,iBAAiB,CAAClI,KAAK,CAACoI,EAAP,CAAjB,GAA4BpI,KAAK,CAACsH,OAAlC;AAA2C;;AAAA,wBAAIe,QAAQ,GAACrI,KAAb;;AAAmB,wBAAGkI,iBAAiB,CAAClI,KAAK,CAACoI,EAAP,CAApB,EAA+B;AAACC,sBAAAA,QAAQ,CAACf,OAAT,GAAiB,IAAjB;AAAuB;;AAAAW,oBAAAA,mBAAmB,CAACjI,KAAK,CAACoI,EAAP,CAAnB,GAA8BC,QAA9B;AAAwC,mBAArN;AAAwN;;AAAA,oBAAG/K,KAAK,CAACC,OAAN,CAAc4K,OAAO,CAAC5I,cAAtB,CAAH,EAAyC;AAAC4I,kBAAAA,OAAO,CAAC5I,cAAR,CAAuBsC,OAAvB,CAA+B,UAAS7B,KAAT,EAAe;AAAC,wBAAG,CAACgI,iBAAiB,CAAChI,KAAK,CAACoI,EAAP,CAArB,EAAgC;AAACP,sBAAAA,mBAAmB,GAAC,CAAC7H,KAAD,EAAQ8E,MAAR,CAAe1H,kBAAkB,CAACyK,mBAAD,CAAjC,CAApB;AAA6E,qBAA9G,MAAkH;AAACG,sBAAAA,iBAAiB,CAAChI,KAAK,CAACoI,EAAP,CAAjB,GAA4B,IAA5B;AAAkC;AAAC,mBAArM;AAAwM;AAAC,eAAlrB;AAAorB,kBAAIE,kBAAkB,GAAC3N,MAAM,CAAC4N,MAAP,CAAcN,mBAAd,CAAvB;;AAA0D,kBAAGK,kBAAkB,CAAClN,MAAtB,EAA6B;AAACuC,gBAAAA,QAAQ,CAACiF,aAAa,CAAC;AAAC5C,kBAAAA,KAAK,EAACsI,kBAAP;AAA0B/I,kBAAAA,cAAc,EAACsI,mBAAzC;AAA6D9G,kBAAAA,kBAAkB,EAAC+G,uBAAhF;AAAwG9E,kBAAAA,iBAAiB,EAAC+E;AAA1H,iBAAD,CAAd,CAAR;AAA4K;;AAAArE,cAAAA,YAAY,GAAC,EAAb;AAAiB,aAA7nC,EAA8nCa,QAA9nC,CAAV;AAAmpC;;AAAAZ,UAAAA,IAAI,GAAC,IAAL;AAAUD,UAAAA,YAAY,CAAC8E,IAAb,CAAkB;AAACxI,YAAAA,KAAK,EAAC2E,UAAP;AAAkBpF,YAAAA,cAAc,EAACA,cAAjC;AAAgDwB,YAAAA,kBAAkB,EAACA,kBAAnE;AAAsFiC,YAAAA,iBAAiB,EAACtF;AAAxG,WAAlB;AAAyI,SAA11C,MAA81C;AAACC,UAAAA,QAAQ,CAACiF,aAAa,CAAC;AAAC5C,YAAAA,KAAK,EAAC2E,UAAP;AAAkBpF,YAAAA,cAAc,EAACA,cAAjC;AAAgDwB,YAAAA,kBAAkB,EAACA,kBAAnE;AAAsFiC,YAAAA,iBAAiB,EAACtF;AAAxG,WAAD,CAAd,CAAR;AAA+I;AAAC,OAA5yD,MAAgzD;AAACC,QAAAA,QAAQ,CAACoC,OAAO,CAAC4E,UAAD,EAAYpF,cAAZ,EAA2B,KAA3B,EAAiC7B,WAAW,CAACmJ,QAAZ,CAAqB,YAArB,CAAjC,EAAoE3G,SAApE,EAA8EG,aAA9E,CAAR,CAAR;AAA+G;AAAC;AAAC,GAAryL;AAAuyL;;AAAA,SAASzE,eAAT,CAAyBkG,SAAzB,EAAmCuC,YAAnC,EAAgD;AAAC,MAAIiD,OAAO,GAACnM,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,IAAtE;AAA2E,SAAO,UAASwC,QAAT,EAAkB;AAACA,IAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACuM,kBAAT,EAA6B3G,SAA7B,EAAuCuC,YAAvC,CAAD,CAAR;;AAA+D,QAAGiD,OAAH,EAAW;AAAC3J,MAAAA,QAAQ,CAAChC,YAAY,CAACmG,SAAD,EAAW,IAAX,CAAb,CAAR;AAAwC;AAAC,GAA9I;AAAgJ;;AAAA,SAASjG,WAAT,CAAqB6M,KAArB,EAA2B;AAAC,MAAIhL,WAAW,GAACgL,KAAK,CAAChL,WAAtB;AAAA,MAAkCsC,KAAK,GAAC0I,KAAK,CAAC1I,KAA9C;AAAA,MAAoDlF,KAAK,GAAC4N,KAAK,CAAC5N,KAAhE;AAAA,MAAsE6N,WAAW,GAACD,KAAK,CAACE,KAAxF;AAAA,MAA8FA,KAAK,GAACD,WAAW,KAAGzI,SAAd,GAAwB,IAAxB,GAA6ByI,WAAjI;AAAA,MAA6IE,gBAAgB,GAACH,KAAK,CAACI,UAApK;AAAA,MAA+KA,UAAU,GAACD,gBAAgB,KAAG3I,SAAnB,GAA6B,IAA7B,GAAkC2I,gBAA5N;AAAA,MAA6OE,eAAe,GAACL,KAAK,CAACM,SAAnQ;AAAA,MAA6QA,SAAS,GAACD,eAAe,KAAG7I,SAAlB,GAA4B,KAA5B,GAAkC6I,eAAzT;AAAA,MAAyUE,mBAAmB,GAACP,KAAK,CAACrI,aAAnW;AAAA,MAAiXA,aAAa,GAAC4I,mBAAmB,KAAG/I,SAAtB,GAAgC,IAAhC,GAAqC+I,mBAApa;AAAA,MAAwbC,cAAc,GAACR,KAAK,CAACS,QAA7c;AAAA,MAAsdA,QAAQ,GAACD,cAAc,KAAGhJ,SAAjB,GAA2B,IAA3B,GAAgCgJ,cAA/f;AAAA,MAA8gBE,UAAU,GAACV,KAAK,CAACW,IAA/hB;AAAA,MAAoiBA,IAAI,GAACD,UAAU,KAAGlJ,SAAb,GAAuB,EAAvB,GAA0BkJ,UAAnkB;AAA8kB,MAAI9B,OAAO,GAACnM,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,IAAtE;AAA2E,SAAO,UAASwC,QAAT,EAAkB;AAAC,QAAI2L,eAAe,GAACtJ,KAApB;;AAA0B,QAAGA,KAAK,IAAEA,KAAK,CAACA,KAAhB,EAAsB;AAACsJ,MAAAA,eAAe,GAACtJ,KAAK,CAACA,KAAtB;AAA6B;;AAAA,QAAG,CAACtC,WAAW,CAACmJ,QAAZ,CAAqB,YAArB,CAAJ,EAAuC;AAAClJ,MAAAA,QAAQ,CAAC,CAAC,GAAE5B,MAAM,CAACsJ,QAAV,EAAoB3H,WAApB,EAAgC5C,KAAhC,EAAsC8N,KAAtC,EAA4CE,UAA5C,EAAuDE,SAAvD,EAAiE3I,aAAjE,EAA+E8I,QAA/E,EAAwFE,IAAxF,CAAD,CAAR;;AAAwG,UAAGhJ,aAAa,KAAG3D,UAAU,CAACkE,cAAX,CAA0B2I,kBAA7C,EAAgE;AAAC5L,QAAAA,QAAQ,CAAC,CAAC,GAAE5B,MAAM,CAACyN,gBAAV,EAA4B,CAAC,GAAE7M,UAAU,CAAC8M,uBAAd,EAAuC/L,WAAvC,CAA5B,EAAgF5C,KAAhF,EAAsFuF,aAAtF,EAAoG8I,QAApG,EAA6GE,IAA7G,CAAD,CAAR;AAA8H,OAA/L,MAAmM;AAAC1L,QAAAA,QAAQ,CAAC,CAAC,GAAE5B,MAAM,CAACyN,gBAAV,EAA4B9L,WAAW,GAAC,YAAxC,EAAqD5C,KAArD,EAA2DuF,aAA3D,EAAyE8I,QAAzE,EAAkFE,IAAlF,CAAD,CAAR;AAAmG;AAAC,KAAxb,MAA4b;AAAC1L,MAAAA,QAAQ,CAAC,CAAC,GAAE5B,MAAM,CAACyN,gBAAV,EAA4B9L,WAA5B,EAAwC5C,KAAxC,EAA8CuF,aAA9C,EAA4D8I,QAA5D,EAAqEE,IAArE,CAAD,CAAR;AAAsF;;AAAA1L,IAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACwN,QAAT,EAAmBhM,WAAnB,EAA+B4L,eAA/B,CAAD,CAAR;AAA0D,QAAGhC,OAAH,EAAW3J,QAAQ,CAAChC,YAAY,CAAC+B,WAAD,EAAa,IAAb,EAAkB,KAAlB,EAAwB2C,aAAxB,CAAb,CAAR;AAA8D,GAA9vB;AAAgwB;;AAAA,SAASvE,QAAT,CAAkBgG,SAAlB,EAA4B6H,UAA5B,EAAuC;AAAC,MAAI1J,YAAY,GAAC9E,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,IAA3E;AAAgF,MAAIiF,YAAY,GAACjF,SAAS,CAACC,MAAV,GAAiB,CAAjB,IAAoBD,SAAS,CAAC,CAAD,CAAT,KAAe+E,SAAnC,GAA6C/E,SAAS,CAAC,CAAD,CAAtD,GAA0D,KAA3E;AAAiF,SAAO,UAASwC,QAAT,EAAkBC,QAAlB,EAA2B;AAAC,QAAIgM,KAAK,GAAChM,QAAQ,EAAlB;;AAAqB,QAAIiM,YAAY,GAAC,CAAC,GAAE1N,OAAO,CAACoJ,UAAX,EAAuBzD,SAAvB,EAAiC8H,KAAK,CAACzF,cAAvC,EAAsDyF,KAAK,CAACxF,SAA5D,EAAsEwF,KAAK,CAACvF,YAA5E,CAAjB;AAAA,QAA2GmB,QAAQ,GAACqE,YAAY,CAACrE,QAAjI;AAAA,QAA0IC,OAAO,GAACoE,YAAY,CAACpE,OAA/J;;AAAuK,QAAIzB,QAAQ,GAAC4F,KAAK,CAAC5F,QAAnB;AAA4B,QAAG,CAACyB,OAAJ,EAAYA,OAAO,GAAC,EAAR;AAAWA,IAAAA,OAAO,GAAC1K,QAAQ,CAAC,EAAD,EAAI0K,OAAJ,EAAYkE,UAAZ,CAAhB;;AAAwC,QAAG,CAACnE,QAAD,IAAWA,QAAQ,IAAE,CAAC7K,MAAM,CAACgL,IAAP,CAAYH,QAAZ,EAAsBpK,MAA/C,EAAsD;AAACoK,MAAAA,QAAQ,GAAC;AAACR,QAAAA,SAAS,EAAC;AAAX,OAAT;AAAyB;;AAAA,QAAIc,YAAY,GAAC/K,QAAQ,CAAC;AAACiF,MAAAA,KAAK,EAACjF,QAAQ,CAAC,EAAD,EAAIyK,QAAJ;AAAf,KAAD,EAA+BC,OAA/B,CAAzB;;AAAiE,QAAG,CAAC,GAAEtJ,OAAO,CAAC8J,OAAX,EAAoBjC,QAAQ,CAAClC,SAAD,CAA5B,EAAwCgE,YAAxC,CAAH,EAAyD;AAAOnI,IAAAA,QAAQ,CAAC,CAAC,GAAEzB,KAAK,CAACgK,QAAT,EAAmBpE,SAAnB,EAA6BgE,YAA7B,CAAD,CAAR;;AAAqD,QAAG8D,KAAK,CAAC9L,MAAN,IAAc8L,KAAK,CAAC9L,MAAN,CAAaK,aAA9B,EAA4C;AAAC,UAAIyG,YAAY,GAAC,EAAjB;AAAoB,UAAIxG,cAAc,GAACwL,KAAK,CAAC5L,KAAN,CAAY8D,SAAZ,KAAwB,EAA3C;AAA8C,UAAIgI,yBAAyB,GAAC1L,cAAc,CAAC2L,gBAA7C;AAA8D,UAAIC,SAAS,GAACrN,UAAU,CAACsN,kBAAX,CAA8B7L,cAAc,CAACiC,aAA7C,CAAd;;AAA0E,UAAG2J,SAAS,KAAGtN,UAAU,CAACwN,UAAX,CAAsBC,IAArC,EAA0C;AAACL,QAAAA,yBAAyB,GAAC1L,cAAc,CAACgM,SAAzC;AAAoD;;AAAA,UAAIpK,KAAK,GAAC,CAAC,GAAErD,UAAU,CAACqK,UAAd,EAA0BlF,SAA1B,EAAoC,CAAC,GAAEnF,UAAU,CAACsK,qBAAd,EAAqC2C,KAArC,EAA2C9H,SAA3C,EAAqD;AAACrE,QAAAA,IAAI,EAACgI,OAAO,CAAChI,IAAd;AAAmB4M,QAAAA,KAAK,EAACT,KAAK,CAACU,YAAN,CAAmBxI,SAAnB,KAA+B8H,KAAK,CAACU,YAAN,CAAmBxI,SAAnB,EAA8BgI,yBAA9B,CAA/B,IAAyFF,KAAK,CAACU,YAAN,CAAmBxI,SAAnB,EAA8BgI,yBAA9B,EAAyDS,SAAlJ,IAA6JrK;AAAtL,OAArD,CAApC,CAAV;AAAsS0E,MAAAA,YAAY,GAAC7J,QAAQ,CAACiC,eAAe,CAAC,EAAD,EAAI8E,SAAJ,EAAc9B,KAAd,CAAhB,EAAqC,CAAC,GAAErD,UAAU,CAACuK,mBAAd,EAAmCtJ,QAAQ,EAA3C,EAA8CkE,SAA9C,EAAwD,EAAxD,CAArC,CAArB;AAAuH,UAAI6C,UAAU,GAAChK,MAAM,CAACgL,IAAP,CAAYf,YAAZ,EAA0B4C,GAA1B,CAA8B,UAASgD,CAAT,EAAW;AAAC,eAAO5F,YAAY,CAAC4F,CAAD,CAAnB;AAAwB,OAAlE,CAAf;AAAmF7M,MAAAA,QAAQ,CAACiF,aAAa,CAAC;AAAC5C,QAAAA,KAAK,EAAC2E,UAAP;AAAkBpF,QAAAA,cAAc,EAAC,CAACuC,SAAD,CAAjC;AAA6C7B,QAAAA,YAAY,EAACA,YAA1D;AAAuEG,QAAAA,YAAY,EAACA;AAApF,OAAD,CAAd,CAAR;AAA4H,KAAl8B,MAAs8B;AAAC,UAAImH,UAAU,GAACqC,KAAK,CAAC9L,MAAN,IAAc8L,KAAK,CAAC9L,MAAN,CAAamD,eAA3B,IAA4C2I,KAAK,CAAC9L,MAAN,CAAamD,eAAb,CAA6BS,MAAzE,GAAgFkI,KAAK,CAAC9L,MAAN,CAAamD,eAAb,CAA6BS,MAA7B,GAAoC,GAApC,GAAwCI,SAAxH,GAAkIA,SAAjJ;AAA2J,UAAI2I,WAAW,GAAC,CAAC;AAAClD,QAAAA,UAAU,EAACA;AAAZ,OAAD,EAAyBzB,YAAzB,CAAhB;AAAuDnI,MAAAA,QAAQ,CAACoC,OAAO,CAAC0K,WAAD,EAAa,CAAC3I,SAAD,CAAb,EAAyB7B,YAAzB,EAAsC,KAAtC,EAA4CG,YAA5C,CAAR,CAAR;AAA4E;AAAC,GAAtyD;AAAwyD","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.loadPopularSuggestions=loadPopularSuggestions;exports.executeQuery=executeQuery;exports.setQueryOptions=setQueryOptions;exports.updateQuery=updateQuery;exports.loadMore=loadMore;var _value=require('./value');var _utils=require('./utils');var _misc=require('./misc');var _helper=require('../utils/helper');var _analytics=require('../utils/analytics');var _analytics2=_interopRequireDefault(_analytics);var _maps=require('./maps');var _graphQL=require('../utils/graphQL');var _graphQL2=_interopRequireDefault(_graphQL);var _constants=require('../utils/constants');var _transform=require('../utils/transform');var _transform2=require('../../lib/utils/transform');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function loadPopularSuggestions(componentId){return function(dispatch,getState){var _getState=getState(),config=_getState.config,appbaseRef=_getState.appbaseRef,props=_getState.props,internalValues=_getState.internalValues;var isAppbaseEnabled=config&&config.enableAppbase;var componentProps=props[componentId]||{};var internalValue=internalValues[componentId];var value=internalValue&&internalValue.value||'';if(isAppbaseEnabled&&(componentProps.enablePopularSuggestions||componentProps.enableQuerySuggestions)){if(config.mongodb){dispatch((0,_misc.setDefaultPopularSuggestions)([],componentId.split('__internal')[0]));return;}var suggQuery=(0,_utils.getSuggestionQuery)(getState,componentId);appbaseRef.getQuerySuggestions(suggQuery).then(function(suggestions){var querySuggestion=suggestions[(0,_utils.getQuerySuggestionsId)(componentId)];if(value){dispatch((0,_misc.setPopularSuggestions)(querySuggestion&&querySuggestion.hits&&querySuggestion.hits.hits,componentId.split('__internal')[0]));}else{dispatch((0,_misc.setDefaultPopularSuggestions)(querySuggestion&&querySuggestion.hits&&querySuggestion.hits.hits,componentId.split('__internal')[0]));}}).catch(function(e){(0,_utils.handleError)({orderOfQueries:[componentId],error:e},getState,dispatch);});}};}var handleTransformRequest=function handleTransformRequest(transformRequest,res){if(transformRequest&&typeof transformRequest==='function'){var transformRequestPromise=transformRequest(res);return transformRequestPromise instanceof Promise?transformRequestPromise:Promise.resolve(transformRequestPromise);}return Promise.resolve(res);};function msearch(query,orderOfQueries){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isInternalComponent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var appendToAggs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var componentType=arguments[5];return function(dispatch,getState){var _getState2=getState(),appbaseRef=_getState2.appbaseRef,config=_getState2.config,headers=_getState2.headers,analytics=_getState2.analytics,selectedValues=_getState2.selectedValues;var searchHeaders={};var suggestionsComponents=[_constants.componentTypes.dataSearch,_constants.componentTypes.categorySearch];var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;if(config.analytics){if(config.analyticsConfig.suggestionAnalytics&&isSuggestionsQuery){var suggestionsSearchValue=analytics.suggestionsSearchValue;var shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||suggestionsSearchValue);if(shouldIncludeQuery){searchHeaders={'X-Search-Query':suggestionsSearchValue||''};}}else{var searchValue=analytics.searchValue,searchId=analytics.searchId;var filterString=(0,_analytics2.default)(selectedValues);if(searchId){searchHeaders=_extends({'X-Search-Id':searchId,'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}else{var _shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||searchValue);searchHeaders=_extends(_shouldIncludeQuery&&{'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}}if(config.analyticsConfig.userId){searchHeaders['X-User-Id']=config.analyticsConfig.userId;}if(config.analyticsConfig.customEvents){searchHeaders['X-Search-CustomEvent']=(0,_analytics.parseCustomEvents)(config.analyticsConfig.customEvents);}}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});if(config.graphQLUrl){var requestOptions={graphQLUrl:config.graphQLUrl,url:config.url,credentials:config.credentials,app:config.app,query:query,headers:headers};handleTransformRequest(appbaseRef.transformRequest,requestOptions).then(function(modifiedRequest){(0,_graphQL2.default)(modifiedRequest).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}else{appbaseRef.setHeaders(_extends({},headers,searchHeaders));appbaseRef.msearch({type:config.type==='*'?'':config.type,body:query}).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}};}function appbaseSearch(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},query=_ref.query,orderOfQueries=_ref.orderOfQueries,_ref$appendToHits=_ref.appendToHits,appendToHits=_ref$appendToHits===undefined?false:_ref$appendToHits,_ref$isSuggestionsQue=_ref.isSuggestionsQuery,isSuggestionsQuery=_ref$isSuggestionsQue===undefined?false:_ref$isSuggestionsQue,searchComponentID=_ref.searchComponentID,_ref$appendToAggs=_ref.appendToAggs,appendToAggs=_ref$appendToAggs===undefined?false:_ref$appendToAggs;return function(dispatch,getState){var _getState3=getState(),appbaseRef=_getState3.appbaseRef,config=_getState3.config,headers=_getState3.headers;var isAnalyticsEnabled=false;if(config){if((0,_utils.isPropertyDefined)(config.analytics)){isAnalyticsEnabled=config.analytics;}else if(config.analyticsConfig){if((0,_utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)){isAnalyticsEnabled=config.analyticsConfig.recordAnalytics;}else if((0,_utils.isPropertyDefined)(config.analyticsConfig.analytics)){isAnalyticsEnabled=config.analyticsConfig.analytics;}}}var settings={recordAnalytics:isAnalyticsEnabled};if(config.analyticsConfig){settings.userId=(0,_utils.isPropertyDefined)(config.analyticsConfig.userId)?config.analyticsConfig.userId:undefined;settings.enableQueryRules=(0,_utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules)?config.analyticsConfig.enableQueryRules:undefined;settings.customEvents=(0,_utils.isPropertyDefined)(config.analyticsConfig.customEvents)?config.analyticsConfig.customEvents:undefined;}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});appbaseRef.setHeaders(_extends({},headers));if(isSuggestionsQuery&&searchComponentID){dispatch(loadPopularSuggestions(searchComponentID));}appbaseRef.reactiveSearchv3(query,settings).then(function(res){(0,_utils.handleResponse)({res:res,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});};}var requestStack=[];var lock=false;function executeQuery(componentId){var executeWatchList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var mustExecuteMapQuery=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var componentType=arguments[3];var metaOptions=arguments[4];return function(dispatch,getState){var _getState4=getState(),queryLog=_getState4.queryLog,config=_getState4.config,mapData=_getState4.mapData,watchMan=_getState4.watchMan,dependencyTree=_getState4.dependencyTree,queryList=_getState4.queryList,queryOptions=_getState4.queryOptions,queryListener=_getState4.queryListener,props=_getState4.props,selectedValues=_getState4.selectedValues,internalValues=_getState4.internalValues;var lockTime=config.initialQueriesSyncTime;var initialTimestamp=config.initialTimestamp;var componentList=[componentId];var finalQuery=[];var appbaseQuery={};var orderOfQueries=[];var isAppbaseEnabled=config&&config.enableAppbase;if(executeWatchList){var watchList=watchMan[componentId]||[];componentList=[].concat(_toConsumableArray(componentList),_toConsumableArray(watchList));}var matchAllQuery={match_all:{}};componentList.forEach(function(component){var componentProps=props[component];if(selectedValues[componentId]&&selectedValues[componentId].reference!=='URL'&&componentProps&&[_constants.componentTypes.reactiveList,_constants.componentTypes.reactiveMap].includes(componentProps.componentType)){dispatch((0,_value.setValue)(component,null));}var _buildQuery=(0,_helper.buildQuery)(component,dependencyTree,queryList,queryOptions),queryObj=_buildQuery.queryObj,options=_buildQuery.options;var validOptions=['aggs','from','sort'];if(queryObj&&!!Object.keys(queryObj).length||options&&Object.keys(options).some(function(item){return validOptions.includes(item);})){if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj=_extends({},matchAllQuery);}var currentQuery=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var queryToLog=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var oldQuery=queryLog[component];if(mustExecuteMapQuery||!(0,_helper.isEqual)(currentQuery,oldQuery)){orderOfQueries=[].concat(_toConsumableArray(orderOfQueries),[component]);dispatch((0,_misc.logQuery)(component,queryToLog));var isMapComponent=Object.keys(mapData).includes(component);if(isMapComponent&&mapData[component].query){var existingQuery=currentQuery.query;currentQuery.query={bool:{must:[existingQuery,mapData[component].query]}};if(!mapData[component].persistMapQuery){dispatch((0,_maps.updateMapData)(componentId,null,false));}var _getState5=getState(),combinedLog=_getState5.combinedLog;if((0,_helper.isEqual)(combinedLog[component],currentQuery))return;dispatch((0,_misc.logCombinedQuery)(component,currentQuery));}(0,_utils.executeQueryListener)(queryListener[component],oldQuery,currentQuery);if(isAppbaseEnabled){var value=void 0;var isInternalComponent=componentId.endsWith('__internal');var mainComponentProps=props[componentId];if(isInternalComponent&&mainComponentProps&&(0,_transform.isSearchComponent)(mainComponentProps.componentType)){value=internalValues[componentId]&&internalValues[componentId].value;}var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(getState(),component,_extends({},value?{value:value}:null,metaOptions?{from:metaOptions.from}:null)));if(query){appbaseQuery=_extends({},appbaseQuery,_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,orderOfQueries));}if(isMapComponent){var internalComponent=(0,_transform2.getInternalComponentID)(component);var internalQuery=(0,_transform.getRSQuery)(internalComponent,(0,_transform.extractPropsFromState)(getState(),internalComponent,metaOptions?{from:metaOptions.from}:null));if(internalQuery){appbaseQuery[internalComponent]=_extends({},internalQuery,{execute:false});}}}else{var preference=config&&config.analyticsConfig&&config.analyticsConfig.userId?config.analyticsConfig.userId+'_'+component:component;finalQuery=[].concat(_toConsumableArray(finalQuery),[{preference:preference},currentQuery]);}}}});if(isAppbaseEnabled){finalQuery=Object.keys(appbaseQuery).map(function(component){return appbaseQuery[component];});}if(finalQuery.length){if(isAppbaseEnabled){var suggestionsComponents=[_constants.componentTypes.dataSearch,_constants.componentTypes.categorySearch];var isInternalComponent=componentId.endsWith('__internal');var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;var currentTime=new Date().getTime();if(currentTime-initialTimestamp<lockTime){if(!lock){setTimeout(function(){var finalOrderOfQueries=[];var finalIsSuggestionsQuery=false;var finalSearchComponentID='';var orderOfQueriesMap={};var processedQueriesMap={};var queryExecutionMap={};requestStack.forEach(function(request){if(!finalIsSuggestionsQuery){finalIsSuggestionsQuery=request.isSuggestionsQuery;}if(!finalSearchComponentID){finalSearchComponentID=request.searchComponentID;}if(Array.isArray(request.query)){request.query.forEach(function(query){if(query.execute){queryExecutionMap[query.id]=query.execute;}var newQuery=query;if(queryExecutionMap[query.id]){newQuery.execute=true;}processedQueriesMap[query.id]=newQuery;});}if(Array.isArray(request.orderOfQueries)){request.orderOfQueries.forEach(function(query){if(!orderOfQueriesMap[query.id]){finalOrderOfQueries=[query].concat(_toConsumableArray(finalOrderOfQueries));}else{orderOfQueriesMap[query.id]=true;}});}});var finalCombinedQuery=Object.values(processedQueriesMap);if(finalCombinedQuery.length){dispatch(appbaseSearch({query:finalCombinedQuery,orderOfQueries:finalOrderOfQueries,isSuggestionsQuery:finalIsSuggestionsQuery,searchComponentID:finalSearchComponentID}));}requestStack=[];},lockTime);}lock=true;requestStack.push({query:finalQuery,orderOfQueries:orderOfQueries,isSuggestionsQuery:isSuggestionsQuery,searchComponentID:componentId});}else{dispatch(appbaseSearch({query:finalQuery,orderOfQueries:orderOfQueries,isSuggestionsQuery:isSuggestionsQuery,searchComponentID:componentId}));}}else{dispatch(msearch(finalQuery,orderOfQueries,false,componentId.endsWith('__internal'),undefined,componentType));}}};}function setQueryOptions(component,queryOptions){var execute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return function(dispatch){dispatch((0,_misc.updateQueryOptions)(component,queryOptions));if(execute){dispatch(executeQuery(component,true));}};}function updateQuery(_ref2){var componentId=_ref2.componentId,query=_ref2.query,value=_ref2.value,_ref2$label=_ref2.label,label=_ref2$label===undefined?null:_ref2$label,_ref2$showFilter=_ref2.showFilter,showFilter=_ref2$showFilter===undefined?true:_ref2$showFilter,_ref2$URLParams=_ref2.URLParams,URLParams=_ref2$URLParams===undefined?false:_ref2$URLParams,_ref2$componentType=_ref2.componentType,componentType=_ref2$componentType===undefined?null:_ref2$componentType,_ref2$category=_ref2.category,category=_ref2$category===undefined?null:_ref2$category,_ref2$meta=_ref2.meta,meta=_ref2$meta===undefined?{}:_ref2$meta;var execute=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(dispatch){var queryToDispatch=query;if(query&&query.query){queryToDispatch=query.query;}if(!componentId.endsWith('__internal')){dispatch((0,_value.setValue)(componentId,value,label,showFilter,URLParams,componentType,category,meta));if(componentType===_constants.componentTypes.dynamicRangeSlider){dispatch((0,_value.setInternalValue)((0,_transform.getHistogramComponentID)(componentId),value,componentType,category,meta));}else{dispatch((0,_value.setInternalValue)(componentId+'__internal',value,componentType,category,meta));}}else{dispatch((0,_value.setInternalValue)(componentId,value,componentType,category,meta));}dispatch((0,_misc.setQuery)(componentId,queryToDispatch));if(execute)dispatch(executeQuery(componentId,true,false,componentType));};}function loadMore(component,newOptions){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var appendToAggs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return function(dispatch,getState){var store=getState();var _buildQuery2=(0,_helper.buildQuery)(component,store.dependencyTree,store.queryList,store.queryOptions),queryObj=_buildQuery2.queryObj,options=_buildQuery2.options;var queryLog=store.queryLog;if(!options)options={};options=_extends({},options,newOptions);if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj={match_all:{}};}var currentQuery=_extends({query:_extends({},queryObj)},options);if((0,_helper.isEqual)(queryLog[component],currentQuery))return;dispatch((0,_misc.logQuery)(component,currentQuery));if(store.config&&store.config.enableAppbase){var appbaseQuery={};var componentProps=store.props[component]||{};var compositeAggregationField=componentProps.aggregationField;var queryType=_transform.componentToTypeMap[componentProps.componentType];if(queryType===_constants.queryTypes.term){compositeAggregationField=componentProps.dataField;}var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(store,component,{from:options.from,after:store.aggregations[component]&&store.aggregations[component][compositeAggregationField]&&store.aggregations[component][compositeAggregationField].after_key||undefined}));appbaseQuery=_extends(_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,[]));var finalQuery=Object.keys(appbaseQuery).map(function(c){return appbaseQuery[c];});dispatch(appbaseSearch({query:finalQuery,orderOfQueries:[component],appendToHits:appendToHits,appendToAggs:appendToAggs}));}else{var preference=store.config&&store.config.analyticsConfig&&store.config.analyticsConfig.userId?store.config.analyticsConfig.userId+'_'+component:component;var _finalQuery=[{preference:preference},currentQuery];dispatch(msearch(_finalQuery,[component],appendToHits,false,appendToAggs));}};}"]},"metadata":{},"sourceType":"script"}