import _objectWithoutProperties from "@babel/runtime/helpers/objectWithoutProperties";
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";
import _assertThisInitialized from "@babel/runtime/helpers/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/inherits";
import _possibleConstructorReturn from "@babel/runtime/helpers/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/getPrototypeOf";
import _defineProperty from "@babel/runtime/helpers/defineProperty";
var _excluded = ["addFilter", "className", "facets", "field", "filterType", "filters", "label", "removeFilter", "setFilter", "view", "isFilterable", "a11yNotify"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

import React from "react";
import PropTypes from "prop-types";
import { Component } from "react";
import { MultiCheckboxFacet } from "@elastic/react-search-ui-views";
import { helpers } from "@elastic/search-ui";
import { Facet, Filter, FilterType } from "../types";
import { accentFold } from "../helpers";
import { withSearch } from "..";
var markSelectedFacetValuesFromFilters = helpers.markSelectedFacetValuesFromFilters;
export var FacetContainer = /*#__PURE__*/function (_Component) {
  _inherits(FacetContainer, _Component);

  var _super = _createSuper(FacetContainer);

  function FacetContainer(_ref) {
    var _this;

    var _ref$show = _ref.show,
        show = _ref$show === void 0 ? 5 : _ref$show;

    _classCallCheck(this, FacetContainer);

    _this = _super.call(this);

    _defineProperty(_assertThisInitialized(_this), "handleClickMore", function (totalOptions) {
      _this.setState(function (_ref2) {
        var more = _ref2.more;
        var visibleOptionsCount = more + 10;
        var showingAll = visibleOptionsCount >= totalOptions;
        if (showingAll) visibleOptionsCount = totalOptions;

        _this.props.a11yNotify("moreFilters", {
          visibleOptionsCount: visibleOptionsCount,
          showingAll: showingAll
        });

        return {
          more: visibleOptionsCount
        };
      });
    });

    _defineProperty(_assertThisInitialized(_this), "handleFacetSearch", function (searchTerm) {
      _this.setState({
        searchTerm: searchTerm
      });
    });

    _this.state = {
      more: show,
      searchTerm: ""
    };
    return _this;
  }

  _createClass(FacetContainer, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$state = this.state,
          more = _this$state.more,
          searchTerm = _this$state.searchTerm;

      var _this$props = this.props,
          addFilter = _this$props.addFilter,
          className = _this$props.className,
          facets = _this$props.facets,
          field = _this$props.field,
          filterType = _this$props.filterType,
          filters = _this$props.filters,
          label = _this$props.label,
          removeFilter = _this$props.removeFilter,
          setFilter = _this$props.setFilter,
          view = _this$props.view,
          isFilterable = _this$props.isFilterable,
          a11yNotify = _this$props.a11yNotify,
          rest = _objectWithoutProperties(_this$props, _excluded);

      var facetsForField = facets[field];
      if (!facetsForField) return null; // By using `[0]`, we are currently assuming only 1 facet per field. This will likely be enforced
      // in future version, so instead of an array, there will only be one facet allowed per field.

      var facet = facetsForField[0];
      var facetValues = markSelectedFacetValuesFromFilters(facet, filters, field, filterType).data;
      var selectedValues = facetValues.filter(function (fv) {
        return fv.selected;
      }).map(function (fv) {
        return fv.value;
      });
      if (!facetValues.length && !selectedValues.length) return null;

      if (searchTerm.trim()) {
        facetValues = facetValues.filter(function (option) {
          return accentFold(option.value).toLowerCase().includes(accentFold(searchTerm).toLowerCase());
        });
      }

      var View = view || MultiCheckboxFacet;

      var viewProps = _objectSpread({
        className: className,
        label: label,
        onMoreClick: this.handleClickMore.bind(this, facetValues.length),
        onRemove: function onRemove(value) {
          removeFilter(field, value, filterType);
        },
        onChange: function onChange(value) {
          setFilter(field, value, filterType);
        },
        onSelect: function onSelect(value) {
          addFilter(field, value, filterType);
        },
        options: facetValues.slice(0, more),
        showMore: facetValues.length > more,
        values: selectedValues,
        showSearch: isFilterable,
        onSearch: function onSearch(value) {
          _this2.handleFacetSearch(value);
        },
        searchPlaceholder: "Filter ".concat(field)
      }, rest);

      return /*#__PURE__*/React.createElement(View, viewProps);
    }
  }]);

  return FacetContainer;
}(Component);

_defineProperty(FacetContainer, "propTypes", {
  // Props
  className: PropTypes.string,
  field: PropTypes.string.isRequired,
  label: PropTypes.string.isRequired,
  filterType: FilterType,
  show: PropTypes.number,
  view: PropTypes.func,
  isFilterable: PropTypes.bool,
  // State
  filters: PropTypes.arrayOf(Filter).isRequired,
  facets: PropTypes.objectOf(PropTypes.arrayOf(Facet)).isRequired,
  // Actions
  addFilter: PropTypes.func.isRequired,
  removeFilter: PropTypes.func.isRequired,
  setFilter: PropTypes.func.isRequired,
  a11yNotify: PropTypes.func.isRequired
});

_defineProperty(FacetContainer, "defaultProps", {
  filterType: "all",
  isFilterable: false
});

export default withSearch(function (_ref3) {
  var filters = _ref3.filters,
      facets = _ref3.facets,
      addFilter = _ref3.addFilter,
      removeFilter = _ref3.removeFilter,
      setFilter = _ref3.setFilter,
      a11yNotify = _ref3.a11yNotify;
  return {
    filters: filters,
    facets: facets,
    addFilter: addFilter,
    removeFilter: removeFilter,
    setFilter: setFilter,
    a11yNotify: a11yNotify
  };
})(FacetContainer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250YWluZXJzL0ZhY2V0LmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwiUHJvcFR5cGVzIiwiQ29tcG9uZW50IiwiTXVsdGlDaGVja2JveEZhY2V0IiwiaGVscGVycyIsIkZhY2V0IiwiRmlsdGVyIiwiRmlsdGVyVHlwZSIsImFjY2VudEZvbGQiLCJ3aXRoU2VhcmNoIiwibWFya1NlbGVjdGVkRmFjZXRWYWx1ZXNGcm9tRmlsdGVycyIsIkZhY2V0Q29udGFpbmVyIiwic2hvdyIsInRvdGFsT3B0aW9ucyIsInNldFN0YXRlIiwibW9yZSIsInZpc2libGVPcHRpb25zQ291bnQiLCJzaG93aW5nQWxsIiwicHJvcHMiLCJhMTF5Tm90aWZ5Iiwic2VhcmNoVGVybSIsInN0YXRlIiwiYWRkRmlsdGVyIiwiY2xhc3NOYW1lIiwiZmFjZXRzIiwiZmllbGQiLCJmaWx0ZXJUeXBlIiwiZmlsdGVycyIsImxhYmVsIiwicmVtb3ZlRmlsdGVyIiwic2V0RmlsdGVyIiwidmlldyIsImlzRmlsdGVyYWJsZSIsInJlc3QiLCJmYWNldHNGb3JGaWVsZCIsImZhY2V0IiwiZmFjZXRWYWx1ZXMiLCJkYXRhIiwic2VsZWN0ZWRWYWx1ZXMiLCJmaWx0ZXIiLCJmdiIsInNlbGVjdGVkIiwibWFwIiwidmFsdWUiLCJsZW5ndGgiLCJ0cmltIiwib3B0aW9uIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsIlZpZXciLCJ2aWV3UHJvcHMiLCJvbk1vcmVDbGljayIsImhhbmRsZUNsaWNrTW9yZSIsImJpbmQiLCJvblJlbW92ZSIsIm9uQ2hhbmdlIiwib25TZWxlY3QiLCJvcHRpb25zIiwic2xpY2UiLCJzaG93TW9yZSIsInZhbHVlcyIsInNob3dTZWFyY2giLCJvblNlYXJjaCIsImhhbmRsZUZhY2V0U2VhcmNoIiwic2VhcmNoUGxhY2Vob2xkZXIiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwibnVtYmVyIiwiZnVuYyIsImJvb2wiLCJhcnJheU9mIiwib2JqZWN0T2YiXSwibWFw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Q0FBQ3NFLFFBQVYsQ0FBbUJ0RSxTQUFTLENBQUNxRSxPQUFWLENBQWtCakUsS0FBbEIsQ0FBbkIsRUFBNkM2RCxVQVhwQztBQVlqQjtBQUNBNUMsRUFBQUEsU0FBUyxFQUFFckIsU0FBUyxDQUFDbUUsSUFBVixDQUFlRixVQWJUO0FBY2pCckMsRUFBQUEsWUFBWSxFQUFFNUIsU0FBUyxDQUFDbUUsSUFBVixDQUFlRixVQWRaO0FBZWpCcEMsRUFBQUEsU0FBUyxFQUFFN0IsU0FBUyxDQUFDbUUsSUFBVixDQUFlRixVQWZUO0FBZ0JqQi9DLEVBQUFBLFVBQVUsRUFBRWxCLFNBQVMsQ0FBQ21FLElBQVYsQ0FBZUY7QUFoQlYsQzs7Z0JBRFJ2RCxjLGtCQW9CVztBQUNwQmUsRUFBQUEsVUFBVSxFQUFFLEtBRFE7QUFFcEJNLEVBQUFBLFlBQVksRUFBRTtBQUZNLEM7O0FBMEd4QixlQUFldkIsVUFBVSxDQUN2QjtBQUFBLE1BQUdrQixPQUFILFNBQUdBLE9BQUg7QUFBQSxNQUFZSCxNQUFaLFNBQVlBLE1BQVo7QUFBQSxNQUFvQkYsU0FBcEIsU0FBb0JBLFNBQXBCO0FBQUEsTUFBK0JPLFlBQS9CLFNBQStCQSxZQUEvQjtBQUFBLE1BQTZDQyxTQUE3QyxTQUE2Q0EsU0FBN0M7QUFBQSxNQUF3RFgsVUFBeEQsU0FBd0RBLFVBQXhEO0FBQUEsU0FBMEU7QUFDeEVRLElBQUFBLE9BQU8sRUFBUEEsT0FEd0U7QUFFeEVILElBQUFBLE1BQU0sRUFBTkEsTUFGd0U7QUFHeEVGLElBQUFBLFNBQVMsRUFBVEEsU0FId0U7QUFJeEVPLElBQUFBLFlBQVksRUFBWkEsWUFKd0U7QUFLeEVDLElBQUFBLFNBQVMsRUFBVEEsU0FMd0U7QUFNeEVYLElBQUFBLFVBQVUsRUFBVkE7QUFOd0UsR0FBMUU7QUFBQSxDQUR1QixDQUFWLENBU2JSLGNBVGEsQ0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgTXVsdGlDaGVja2JveEZhY2V0IH0gZnJvbSBcIkBlbGFzdGljL3JlYWN0LXNlYXJjaC11aS12aWV3c1wiO1xuaW1wb3J0IHsgaGVscGVycyB9IGZyb20gXCJAZWxhc3RpYy9zZWFyY2gtdWlcIjtcblxuaW1wb3J0IHsgRmFjZXQsIEZpbHRlciwgRmlsdGVyVHlwZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgYWNjZW50Rm9sZCB9IGZyb20gXCIuLi9oZWxwZXJzXCI7XG5pbXBvcnQgeyB3aXRoU2VhcmNoIH0gZnJvbSBcIi4uXCI7XG5cbmNvbnN0IHsgbWFya1NlbGVjdGVkRmFjZXRWYWx1ZXNGcm9tRmlsdGVycyB9ID0gaGVscGVycztcblxuZXhwb3J0IGNsYXNzIEZhY2V0Q29udGFpbmVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyBQcm9wc1xuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBmaWVsZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgZmlsdGVyVHlwZTogRmlsdGVyVHlwZSxcbiAgICBzaG93OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHZpZXc6IFByb3BUeXBlcy5mdW5jLFxuICAgIGlzRmlsdGVyYWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgLy8gU3RhdGVcbiAgICBmaWx0ZXJzOiBQcm9wVHlwZXMuYXJyYXlPZihGaWx0ZXIpLmlzUmVxdWlyZWQsXG4gICAgZmFjZXRzOiBQcm9wVHlwZXMub2JqZWN0T2YoUHJvcFR5cGVzLmFycmF5T2YoRmFjZXQpKS5pc1JlcXVpcmVkLFxuICAgIC8vIEFjdGlvbnNcbiAgICBhZGRGaWx0ZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgcmVtb3ZlRmlsdGVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHNldEZpbHRlcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBhMTF5Tm90aWZ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBmaWx0ZXJUeXBlOiBcImFsbFwiLFxuICAgIGlzRmlsdGVyYWJsZTogZmFsc2VcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcih7IHNob3cgPSA1IH0pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBtb3JlOiBzaG93LFxuICAgICAgc2VhcmNoVGVybTogXCJcIlxuICAgIH07XG4gIH1cblxuICBoYW5kbGVDbGlja01vcmUgPSB0b3RhbE9wdGlvbnMgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoKHsgbW9yZSB9KSA9PiB7XG4gICAgICBsZXQgdmlzaWJsZU9wdGlvbnNDb3VudCA9IG1vcmUgKyAxMDtcbiAgICAgIGNvbnN0IHNob3dpbmdBbGwgPSB2aXNpYmxlT3B0aW9uc0NvdW50ID49IHRvdGFsT3B0aW9ucztcbiAgICAgIGlmIChzaG93aW5nQWxsKSB2aXNpYmxlT3B0aW9uc0NvdW50ID0gdG90YWxPcHRpb25zO1xuXG4gICAgICB0aGlzLnByb3BzLmExMXlOb3RpZnkoXCJtb3JlRmlsdGVyc1wiLCB7IHZpc2libGVPcHRpb25zQ291bnQsIHNob3dpbmdBbGwgfSk7XG5cbiAgICAgIHJldHVybiB7IG1vcmU6IHZpc2libGVPcHRpb25zQ291bnQgfTtcbiAgICB9KTtcbiAgfTtcblxuICBoYW5kbGVGYWNldFNlYXJjaCA9IHNlYXJjaFRlcm0gPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hUZXJtIH0pO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IG1vcmUsIHNlYXJjaFRlcm0gfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3Qge1xuICAgICAgYWRkRmlsdGVyLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgZmFjZXRzLFxuICAgICAgZmllbGQsXG4gICAgICBmaWx0ZXJUeXBlLFxuICAgICAgZmlsdGVycyxcbiAgICAgIGxhYmVsLFxuICAgICAgcmVtb3ZlRmlsdGVyLFxuICAgICAgc2V0RmlsdGVyLFxuICAgICAgdmlldyxcbiAgICAgIGlzRmlsdGVyYWJsZSxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgYTExeU5vdGlmeSxcbiAgICAgIC4uLnJlc3RcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBmYWNldHNGb3JGaWVsZCA9IGZhY2V0c1tmaWVsZF07XG5cbiAgICBpZiAoIWZhY2V0c0ZvckZpZWxkKSByZXR1cm4gbnVsbDtcblxuICAgIC8vIEJ5IHVzaW5nIGBbMF1gLCB3ZSBhcmUgY3VycmVudGx5IGFzc3VtaW5nIG9ubHkgMSBmYWNldCBwZXIgZmllbGQuIFRoaXMgd2lsbCBsaWtlbHkgYmUgZW5mb3JjZWRcbiAgICAvLyBpbiBmdXR1cmUgdmVyc2lvbiwgc28gaW5zdGVhZCBvZiBhbiBhcnJheSwgdGhlcmUgd2lsbCBvbmx5IGJlIG9uZSBmYWNldCBhbGxvd2VkIHBlciBmaWVsZC5cbiAgICBjb25zdCBmYWNldCA9IGZhY2V0c0ZvckZpZWxkWzBdO1xuXG4gICAgbGV0IGZhY2V0VmFsdWVzID0gbWFya1NlbGVjdGVkRmFjZXRWYWx1ZXNGcm9tRmlsdGVycyhcbiAgICAgIGZhY2V0LFxuICAgICAgZmlsdGVycyxcbiAgICAgIGZpZWxkLFxuICAgICAgZmlsdGVyVHlwZVxuICAgICkuZGF0YTtcblxuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWVzID0gZmFjZXRWYWx1ZXNcbiAgICAgIC5maWx0ZXIoZnYgPT4gZnYuc2VsZWN0ZWQpXG4gICAgICAubWFwKGZ2ID0+IGZ2LnZhbHVlKTtcblxuICAgIGlmICghZmFjZXRWYWx1ZXMubGVuZ3RoICYmICFzZWxlY3RlZFZhbHVlcy5sZW5ndGgpIHJldHVybiBudWxsO1xuXG4gICAgaWYgKHNlYXJjaFRlcm0udHJpbSgpKSB7XG4gICAgICBmYWNldFZhbHVlcyA9IGZhY2V0VmFsdWVzLmZpbHRlcihvcHRpb24gPT5cbiAgICAgICAgYWNjZW50Rm9sZChvcHRpb24udmFsdWUpXG4gICAgICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAuaW5jbHVkZXMoYWNjZW50Rm9sZChzZWFyY2hUZXJtKS50b0xvd2VyQ2FzZSgpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBWaWV3ID0gdmlldyB8fCBNdWx0aUNoZWNrYm94RmFjZXQ7XG5cbiAgICBjb25zdCB2aWV3UHJvcHMgPSB7XG4gICAgICBjbGFzc05hbWUsXG4gICAgICBsYWJlbDogbGFiZWwsXG4gICAgICBvbk1vcmVDbGljazogdGhpcy5oYW5kbGVDbGlja01vcmUuYmluZCh0aGlzLCBmYWNldFZhbHVlcy5sZW5ndGgpLFxuICAgICAgb25SZW1vdmU6IHZhbHVlID0+IHtcbiAgICAgICAgcmVtb3ZlRmlsdGVyKGZpZWxkLCB2YWx1ZSwgZmlsdGVyVHlwZSk7XG4gICAgICB9LFxuICAgICAgb25DaGFuZ2U6IHZhbHVlID0+IHtcbiAgICAgICAgc2V0RmlsdGVyKGZpZWxkLCB2YWx1ZSwgZmlsdGVyVHlwZSk7XG4gICAgICB9LFxuICAgICAgb25TZWxlY3Q6IHZhbHVlID0+IHtcbiAgICAgICAgYWRkRmlsdGVyKGZpZWxkLCB2YWx1ZSwgZmlsdGVyVHlwZSk7XG4gICAgICB9LFxuICAgICAgb3B0aW9uczogZmFjZXRWYWx1ZXMuc2xpY2UoMCwgbW9yZSksXG4gICAgICBzaG93TW9yZTogZmFjZXRWYWx1ZXMubGVuZ3RoID4gbW9yZSxcbiAgICAgIHZhbHVlczogc2VsZWN0ZWRWYWx1ZXMsXG4gICAgICBzaG93U2VhcmNoOiBpc0ZpbHRlcmFibGUsXG4gICAgICBvblNlYXJjaDogdmFsdWUgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZUZhY2V0U2VhcmNoKHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICBzZWFyY2hQbGFjZWhvbGRlcjogYEZpbHRlciAke2ZpZWxkfWAsXG4gICAgICAuLi5yZXN0XG4gICAgfTtcblxuICAgIHJldHVybiA8VmlldyB7Li4udmlld1Byb3BzfSAvPjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB3aXRoU2VhcmNoKFxuICAoeyBmaWx0ZXJzLCBmYWNldHMsIGFkZEZpbHRlciwgcmVtb3ZlRmlsdGVyLCBzZXRGaWx0ZXIsIGExMXlOb3RpZnkgfSkgPT4gKHtcbiAgICBmaWx0ZXJzLFxuICAgIGZhY2V0cyxcbiAgICBhZGRGaWx0ZXIsXG4gICAgcmVtb3ZlRmlsdGVyLFxuICAgIHNldEZpbHRlcixcbiAgICBhMTF5Tm90aWZ5XG4gIH0pXG4pKEZhY2V0Q29udGFpbmVyKTtcbiJdfQ==