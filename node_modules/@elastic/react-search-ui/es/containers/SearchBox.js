import _slicedToArray from "@babel/runtime/helpers/slicedToArray";
import _objectWithoutProperties from "@babel/runtime/helpers/objectWithoutProperties";
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";
import _assertThisInitialized from "@babel/runtime/helpers/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/inherits";
import _possibleConstructorReturn from "@babel/runtime/helpers/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/getPrototypeOf";
import _defineProperty from "@babel/runtime/helpers/defineProperty";
var _excluded = ["autocompleteMinimumCharacters", "autocompleteResults", "autocompleteSuggestions", "autocompletedResults", "autocompletedSuggestions", "className", "autocompleteView", "inputProps", "inputView", "onSelectAutocomplete", "onSubmit", "searchTerm", "view"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

import PropTypes from "prop-types";
import React, { Component } from "react";
import { SearchBox } from "@elastic/react-search-ui-views";
import { withSearch } from "..";
import { Result, Suggestion } from "../types";
export var SearchBoxContainer = /*#__PURE__*/function (_Component) {
  _inherits(SearchBoxContainer, _Component);

  var _super = _createSuper(SearchBoxContainer);

  function SearchBoxContainer() {
    var _this;

    _classCallCheck(this, SearchBoxContainer);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));

    _defineProperty(_assertThisInitialized(_this), "state", {
      isFocused: false
    });

    _defineProperty(_assertThisInitialized(_this), "handleFocus", function () {
      _this.setState({
        isFocused: true
      });
    });

    _defineProperty(_assertThisInitialized(_this), "handleBlur", function () {
      _this.setState({
        isFocused: false
      });
    });

    _defineProperty(_assertThisInitialized(_this), "completeSuggestion", function (searchTerm) {
      var _this$props = _this.props,
          shouldClearFilters = _this$props.shouldClearFilters,
          setSearchTerm = _this$props.setSearchTerm;
      setSearchTerm(searchTerm, {
        shouldClearFilters: shouldClearFilters
      });
    });

    _defineProperty(_assertThisInitialized(_this), "handleSubmit", function (e) {
      var _this$props2 = _this.props,
          shouldClearFilters = _this$props2.shouldClearFilters,
          searchTerm = _this$props2.searchTerm,
          setSearchTerm = _this$props2.setSearchTerm;
      e.preventDefault();
      setSearchTerm(searchTerm, {
        shouldClearFilters: shouldClearFilters
      });
    });

    _defineProperty(_assertThisInitialized(_this), "handleChange", function (value) {
      var _this$props3 = _this.props,
          autocompleteMinimumCharacters = _this$props3.autocompleteMinimumCharacters,
          autocompleteResults = _this$props3.autocompleteResults,
          autocompleteSuggestions = _this$props3.autocompleteSuggestions,
          shouldClearFilters = _this$props3.shouldClearFilters,
          searchAsYouType = _this$props3.searchAsYouType,
          setSearchTerm = _this$props3.setSearchTerm,
          debounceLength = _this$props3.debounceLength;

      var options = _objectSpread(_objectSpread({
        autocompleteMinimumCharacters: autocompleteMinimumCharacters
      }, (autocompleteResults || autocompleteSuggestions || searchAsYouType) && {
        debounce: debounceLength || 200
      }), {}, {
        shouldClearFilters: shouldClearFilters,
        refresh: !!searchAsYouType,
        autocompleteResults: !!autocompleteResults,
        autocompleteSuggestions: !!autocompleteSuggestions
      });

      setSearchTerm(value, options);
    });

    _defineProperty(_assertThisInitialized(_this), "handleNotifyAutocompleteSelected", function (selection) {
      var _this$props4 = _this.props,
          autocompleteResults = _this$props4.autocompleteResults,
          trackAutocompleteClickThrough = _this$props4.trackAutocompleteClickThrough; // Because suggestions don't count as clickthroughs, only
      // results

      if (autocompleteResults && autocompleteResults.shouldTrackClickThrough !== false && !selection.suggestion) {
        var _autocompleteResults$ = autocompleteResults.clickThroughTags,
            clickThroughTags = _autocompleteResults$ === void 0 ? [] : _autocompleteResults$;
        var id = selection.id.raw;
        trackAutocompleteClickThrough(id, clickThroughTags);
      }
    });

    _defineProperty(_assertThisInitialized(_this), "defaultOnSelectAutocomplete", function (selection) {
      if (!selection) return;
      var autocompleteResults = _this.props.autocompleteResults;

      _this.handleNotifyAutocompleteSelected(selection);

      if (!selection.suggestion) {
        var url = selection[autocompleteResults.urlField] ? selection[autocompleteResults.urlField].raw : "";

        if (url) {
          var target = autocompleteResults.linkTarget || "_self";
          window.open(url, target);
        }
      } else {
        _this.completeSuggestion(selection.suggestion);
      }
    });

    return _this;
  }

  _createClass(SearchBoxContainer, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var isFocused = this.state.isFocused;

      var _this$props5 = this.props,
          autocompleteMinimumCharacters = _this$props5.autocompleteMinimumCharacters,
          autocompleteResults = _this$props5.autocompleteResults,
          autocompleteSuggestions = _this$props5.autocompleteSuggestions,
          autocompletedResults = _this$props5.autocompletedResults,
          autocompletedSuggestions = _this$props5.autocompletedSuggestions,
          className = _this$props5.className,
          autocompleteView = _this$props5.autocompleteView,
          inputProps = _this$props5.inputProps,
          inputView = _this$props5.inputView,
          onSelectAutocomplete = _this$props5.onSelectAutocomplete,
          onSubmit = _this$props5.onSubmit,
          searchTerm = _this$props5.searchTerm,
          view = _this$props5.view,
          rest = _objectWithoutProperties(_this$props5, _excluded);

      var View = view || SearchBox;
      var useAutocomplete = (!!autocompleteResults || !!autocompleteSuggestions) && searchTerm.length >= autocompleteMinimumCharacters;
      var autocompletedSuggestionsCount = Object.entries(autocompletedSuggestions // eslint-disable-next-line no-unused-vars
      ).reduce(function (acc, _ref) {
        var _ref2 = _slicedToArray(_ref, 2),
            _ = _ref2[0],
            value = _ref2[1];

        return acc + value.length;
      }, 0);
      var allAutocompletedItemsCount = autocompletedSuggestionsCount + autocompletedResults.length;
      var handleOnSelectAutocomplete;

      if (onSelectAutocomplete) {
        handleOnSelectAutocomplete = function handleOnSelectAutocomplete(selection) {
          onSelectAutocomplete(selection, {
            notifyAutocompleteSelected: _this2.handleNotifyAutocompleteSelected,
            completeSuggestion: _this2.completeSuggestion,
            autocompleteResults: _this2.props.autocompleteResults
          }, _this2.defaultOnSelectAutocomplete);
        };
      }

      var viewProps = _objectSpread({
        allAutocompletedItemsCount: allAutocompletedItemsCount,
        autocompleteView: autocompleteView,
        autocompleteResults: autocompleteResults,
        autocompleteSuggestions: autocompleteSuggestions,
        autocompletedResults: autocompletedResults,
        autocompletedSuggestions: autocompletedSuggestions,
        className: className,
        autocompletedSuggestionsCount: autocompletedSuggestionsCount,
        completeSuggestion: this.completeSuggestion,
        isFocused: isFocused,
        notifyAutocompleteSelected: this.handleNotifyAutocompleteSelected,
        onChange: function onChange(value) {
          return _this2.handleChange(value);
        },
        onSelectAutocomplete: handleOnSelectAutocomplete || this.defaultOnSelectAutocomplete,
        onSubmit: onSubmit ? function (e) {
          e.preventDefault();
          onSubmit(searchTerm);
        } : this.handleSubmit,
        useAutocomplete: useAutocomplete,
        value: searchTerm,
        inputProps: _objectSpread({
          onFocus: this.handleFocus,
          onBlur: this.handleBlur
        }, inputProps),
        inputView: inputView
      }, rest);

      return /*#__PURE__*/React.createElement(View, viewProps);
    }
  }]);

  return SearchBoxContainer;
}(Component);

_defineProperty(SearchBoxContainer, "propTypes", {
  // Props
  autocompleteMinimumCharacters: PropTypes.number,
  autocompleteResults: PropTypes.oneOfType([PropTypes.bool, PropTypes.shape({
    clickThroughTags: PropTypes.arrayOf(PropTypes.string),
    linkTarget: PropTypes.string,
    sectionTitle: PropTypes.string,
    shouldTrackClickThrough: PropTypes.bool,
    titleField: PropTypes.string.isRequired,
    urlField: PropTypes.string.isRequired
  })]),
  autocompleteSuggestions: PropTypes.oneOfType([PropTypes.bool, PropTypes.exact({
    sectionTitle: PropTypes.string
  }), PropTypes.objectOf(PropTypes.exact({
    sectionTitle: PropTypes.string
  }))]),
  autocompleteView: PropTypes.func,
  className: PropTypes.string,
  shouldClearFilters: PropTypes.bool,
  debounceLength: PropTypes.number,
  inputProps: PropTypes.object,
  inputView: PropTypes.func,
  onSelectAutocomplete: PropTypes.func,
  onSubmit: PropTypes.func,
  searchAsYouType: PropTypes.bool,
  view: PropTypes.func,
  // State
  autocompletedResults: PropTypes.arrayOf(Result).isRequired,
  autocompletedSuggestions: PropTypes.objectOf(PropTypes.arrayOf(Suggestion)).isRequired,
  searchTerm: PropTypes.string.isRequired,
  // Actions
  setSearchTerm: PropTypes.func.isRequired,
  trackAutocompleteClickThrough: PropTypes.func.isRequired
});

_defineProperty(SearchBoxContainer, "defaultProps", {
  autocompleteMinimumCharacters: 0,
  shouldClearFilters: true
});

export default withSearch(function (_ref3) {
  var autocompletedResults = _ref3.autocompletedResults,
      autocompletedSuggestions = _ref3.autocompletedSuggestions,
      searchTerm = _ref3.searchTerm,
      setSearchTerm = _ref3.setSearchTerm,
      trackAutocompleteClickThrough = _ref3.trackAutocompleteClickThrough;
  return {
    autocompletedResults: autocompletedResults,
    autocompletedSuggestions: autocompletedSuggestions,
    searchTerm: searchTerm,
    setSearchTerm: setSearchTerm,
    trackAutocompleteClickThrough: trackAutocompleteClickThrough
  };
})(SearchBoxContainer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250YWluZXJzL1NlYXJjaEJveC5qcyJdLCJuYW1lcyI6WyJQcm9wVHlwZXMiLCJSZWFjdCIsIkNvbXBvbmVudCIsIlNlYXJjaEJveCIsIndpdGhTZWFyY2giLCJSZXN1bHQiLCJTdWdnZXN0aW9uIiwiU2VhcmNoQm94Q29udGFpbmVyIiwiaXNGb2N1c2VkIiwic2V0U3RhdGUiLCJzZWFyY2hUZXJtIiwicHJvcHMiLCJzaG91bGRDbGVhckZpbHRlcnMiLCJzZXRTZWFyY2hUZXJtIiwiZSIsInByZXZlbnREZWZhdWx0IiwidmFsdWUiLCJhdXRvY29tcGxldGVNaW5pbXVtQ2hhcmFjdGVycyIsImF1dG9jb21wbGV0ZVJlc3VsdHMiLCJhdXRvY29tcGxldGVTdWdnZXN0aW9ucyIsInNlYXJjaEFzWW91VHlwZSIsImRlYm91bmNlTGVuZ3RoIiwib3B0aW9ucyIsImRlYm91bmNlIiwicmVmcmVzaCIsInNlbGVjdGlvbiIsInRyYWNrQXV0b2NvbXBsZXRlQ2xpY2tUaHJvdWdoIiwic2hvdWxkVHJhY2tDbGlja1Rocm91Z2giLCJzdWdnZXN0aW9uIiwiY2xpY2tUaHJvdWdoVGFncyIsImlkIiwicmF3IiwiaGFuZGxlTm90aWZ5QXV0b2NvbXBsZXRlU2VsZWN0ZWQiLCJ1cmwiLCJ1cmxGaWVsZCIsInRhcmdldCIsImxpbmtUYXJnZXQiLCJ3aW5kb3ciLCJvcGVuIiwiY29tcGxldGVTdWdnZXN0aW9uIiwic3RhdGUiLCJhdXRvY29tcGxldGVkUmVzdWx0cyIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyIsImNsYXNzTmFtZSIsImF1dG9jb21wbGV0ZVZpZXciLCJpbnB1dFByb3BzIiwiaW5wdXRWaWV3Iiwib25TZWxlY3RBdXRvY29tcGxldGUiLCJvblN1Ym1pdCIsInZpZXciLCJyZXN0IiwiVmlldyIsInVzZUF1dG9jb21wbGV0ZSIsImxlbmd0aCIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc0NvdW50IiwiT2JqZWN0IiwiZW50cmllcyIsInJlZHVjZSIsImFjYyIsIl8iLCJhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCIsImhhbmRsZU9uU2VsZWN0QXV0b2NvbXBsZXRlIiwibm90aWZ5QXV0b2NvbXBsZXRlU2VsZWN0ZWQiLCJkZWZhdWx0T25TZWxlY3RBdXRvY29tcGxldGUiLCJ2aWV3UHJvcHMiLCJvbkNoYW5nZSIsImhhbmRsZUNoYW5nZSIsImhhbmRsZVN1Ym1pdCIsIm9uRm9jdXMiLCJoYW5kbGVGb2N1cyIsIm9uQmx1ciIsImhhbmRsZUJsdXIiLCJudW1iZXIiLCJvbmVPZlR5cGUiLCJib29sIiwic2hhcGUiLCJhcnJheU9mIiwic3RyaW5nIiwic2VjdGlvblRpdGxlIiwidGl0bGVGaWVsZCIsImlzUmVxdWlyZWQiLCJleGFjdCIsIm9iamVjdE9mIiwiZnVuYyIsIm9iamVjdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU9BLFNBQVAsTUFBc0IsWUFBdEI7QUFDQSxPQUFPQyxLQUFQLElBQWdCQyxTQUFoQixRQUFpQyxPQUFqQztBQUNBLFNBQVNDLFNBQVQsUUFBMEIsZ0NBQTFCO0FBRUEsU0FBU0MsVUFBVCxRQUEyQixJQUEzQjtBQUNBLFNBQVNDLE1BQVQsRUFBaUJDLFVBQWpCLFFBQW1DLFVBQW5DO0FBRUEsV0FBYUMsa0JBQWI7QUFBQTs7QUFBQTs7QUFBQTtBQUFBOztBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTs7QUFBQSw0REFtRFU7QUFDTkMsTUFBQUEsU0FBUyxFQUFFO0FBREwsS0FuRFY7O0FBQUEsa0VBdURnQixZQUFNO0FBQ2xCLFlBQUtDLFFBQUwsQ0FBYztBQUNaRCxRQUFBQSxTQUFTLEVBQUU7QUFEQyxPQUFkO0FBR0QsS0EzREg7O0FBQUEsaUVBNkRlLFlBQU07QUFDakIsWUFBS0MsUUFBTCxDQUFjO0FBQ1pELFFBQUFBLFNBQVMsRUFBRTtBQURDLE9BQWQ7QUFHRCxLQWpFSDs7QUFBQSx5RUFtRXVCLFVBQUFFLFVBQVUsRUFBSTtBQUNqQyx3QkFBOEMsTUFBS0MsS0FBbkQ7QUFB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QUFDNEUsT0FBVixDQUFrQnZFLE1BQWxCLEVBQTBCMkUsVUFwQy9CO0FBcUNqQnRDLEVBQUFBLHdCQUF3QixFQUFFMUMsU0FBUyxDQUFDa0YsUUFBVixDQUFtQmxGLFNBQVMsQ0FBQzRFLE9BQVYsQ0FBa0J0RSxVQUFsQixDQUFuQixFQUN2QjBFLFVBdENjO0FBdUNqQnRFLEVBQUFBLFVBQVUsRUFBRVYsU0FBUyxDQUFDNkUsTUFBVixDQUFpQkcsVUF2Q1o7QUF3Q2pCO0FBQ0FuRSxFQUFBQSxhQUFhLEVBQUViLFNBQVMsQ0FBQ21GLElBQVYsQ0FBZUgsVUF6Q2I7QUEwQ2pCdEQsRUFBQUEsNkJBQTZCLEVBQUUxQixTQUFTLENBQUNtRixJQUFWLENBQWVIO0FBMUM3QixDOztnQkFEUnpFLGtCLGtCQThDVztBQUNwQlUsRUFBQUEsNkJBQTZCLEVBQUUsQ0FEWDtBQUVwQkwsRUFBQUEsa0JBQWtCLEVBQUU7QUFGQSxDOztBQW1MeEIsZUFBZVIsVUFBVSxDQUN2QjtBQUFBLE1BQ0VxQyxvQkFERixTQUNFQSxvQkFERjtBQUFBLE1BRUVDLHdCQUZGLFNBRUVBLHdCQUZGO0FBQUEsTUFHRWhDLFVBSEYsU0FHRUEsVUFIRjtBQUFBLE1BSUVHLGFBSkYsU0FJRUEsYUFKRjtBQUFBLE1BS0VhLDZCQUxGLFNBS0VBLDZCQUxGO0FBQUEsU0FNTztBQUNMZSxJQUFBQSxvQkFBb0IsRUFBcEJBLG9CQURLO0FBRUxDLElBQUFBLHdCQUF3QixFQUF4QkEsd0JBRks7QUFHTGhDLElBQUFBLFVBQVUsRUFBVkEsVUFISztBQUlMRyxJQUFBQSxhQUFhLEVBQWJBLGFBSks7QUFLTGEsSUFBQUEsNkJBQTZCLEVBQTdCQTtBQUxLLEdBTlA7QUFBQSxDQUR1QixDQUFWLENBY2JuQixrQkFkYSxDQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiO1xuaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgU2VhcmNoQm94IH0gZnJvbSBcIkBlbGFzdGljL3JlYWN0LXNlYXJjaC11aS12aWV3c1wiO1xuXG5pbXBvcnQgeyB3aXRoU2VhcmNoIH0gZnJvbSBcIi4uXCI7XG5pbXBvcnQgeyBSZXN1bHQsIFN1Z2dlc3Rpb24gfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIFNlYXJjaEJveENvbnRhaW5lciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLy8gUHJvcHNcbiAgICBhdXRvY29tcGxldGVNaW5pbXVtQ2hhcmFjdGVyczogUHJvcFR5cGVzLm51bWJlcixcbiAgICBhdXRvY29tcGxldGVSZXN1bHRzOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIFByb3BUeXBlcy5ib29sLFxuICAgICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgY2xpY2tUaHJvdWdoVGFnczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZyksXG4gICAgICAgIGxpbmtUYXJnZXQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHNlY3Rpb25UaXRsZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgc2hvdWxkVHJhY2tDbGlja1Rocm91Z2g6IFByb3BUeXBlcy5ib29sLFxuICAgICAgICB0aXRsZUZpZWxkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIHVybEZpZWxkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWRcbiAgICAgIH0pXG4gICAgXSksXG4gICAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLmJvb2wsXG4gICAgICBQcm9wVHlwZXMuZXhhY3Qoe1xuICAgICAgICBzZWN0aW9uVGl0bGU6IFByb3BUeXBlcy5zdHJpbmdcbiAgICAgIH0pLFxuICAgICAgUHJvcFR5cGVzLm9iamVjdE9mKFxuICAgICAgICBQcm9wVHlwZXMuZXhhY3Qoe1xuICAgICAgICAgIHNlY3Rpb25UaXRsZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgICAgICB9KVxuICAgICAgKVxuICAgIF0pLFxuICAgIGF1dG9jb21wbGV0ZVZpZXc6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBzaG91bGRDbGVhckZpbHRlcnM6IFByb3BUeXBlcy5ib29sLFxuICAgIGRlYm91bmNlTGVuZ3RoOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGlucHV0UHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgaW5wdXRWaWV3OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvblNlbGVjdEF1dG9jb21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25TdWJtaXQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIHNlYXJjaEFzWW91VHlwZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgdmlldzogUHJvcFR5cGVzLmZ1bmMsXG4gICAgLy8gU3RhdGVcbiAgICBhdXRvY29tcGxldGVkUmVzdWx0czogUHJvcFR5cGVzLmFycmF5T2YoUmVzdWx0KS5pc1JlcXVpcmVkLFxuICAgIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uczogUHJvcFR5cGVzLm9iamVjdE9mKFByb3BUeXBlcy5hcnJheU9mKFN1Z2dlc3Rpb24pKVxuICAgICAgLmlzUmVxdWlyZWQsXG4gICAgc2VhcmNoVGVybTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIC8vIEFjdGlvbnNcbiAgICBzZXRTZWFyY2hUZXJtOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHRyYWNrQXV0b2NvbXBsZXRlQ2xpY2tUaHJvdWdoOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBhdXRvY29tcGxldGVNaW5pbXVtQ2hhcmFjdGVyczogMCxcbiAgICBzaG91bGRDbGVhckZpbHRlcnM6IHRydWVcbiAgfTtcblxuICBzdGF0ZSA9IHtcbiAgICBpc0ZvY3VzZWQ6IGZhbHNlXG4gIH07XG5cbiAgaGFuZGxlRm9jdXMgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpc0ZvY3VzZWQ6IHRydWVcbiAgICB9KTtcbiAgfTtcblxuICBoYW5kbGVCbHVyID0gKCkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgaXNGb2N1c2VkOiBmYWxzZVxuICAgIH0pO1xuICB9O1xuXG4gIGNvbXBsZXRlU3VnZ2VzdGlvbiA9IHNlYXJjaFRlcm0gPT4ge1xuICAgIGNvbnN0IHsgc2hvdWxkQ2xlYXJGaWx0ZXJzLCBzZXRTZWFyY2hUZXJtIH0gPSB0aGlzLnByb3BzO1xuICAgIHNldFNlYXJjaFRlcm0oc2VhcmNoVGVybSwge1xuICAgICAgc2hvdWxkQ2xlYXJGaWx0ZXJzXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlU3VibWl0ID0gZSA9PiB7XG4gICAgY29uc3QgeyBzaG91bGRDbGVhckZpbHRlcnMsIHNlYXJjaFRlcm0sIHNldFNlYXJjaFRlcm0gfSA9IHRoaXMucHJvcHM7XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgc2V0U2VhcmNoVGVybShzZWFyY2hUZXJtLCB7XG4gICAgICBzaG91bGRDbGVhckZpbHRlcnNcbiAgICB9KTtcbiAgfTtcblxuICBoYW5kbGVDaGFuZ2UgPSB2YWx1ZSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgYXV0b2NvbXBsZXRlTWluaW11bUNoYXJhY3RlcnMsXG4gICAgICBhdXRvY29tcGxldGVSZXN1bHRzLFxuICAgICAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMsXG4gICAgICBzaG91bGRDbGVhckZpbHRlcnMsXG4gICAgICBzZWFyY2hBc1lvdVR5cGUsXG4gICAgICBzZXRTZWFyY2hUZXJtLFxuICAgICAgZGVib3VuY2VMZW5ndGhcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBhdXRvY29tcGxldGVNaW5pbXVtQ2hhcmFjdGVycyxcbiAgICAgIC4uLigoYXV0b2NvbXBsZXRlUmVzdWx0cyB8fFxuICAgICAgICBhdXRvY29tcGxldGVTdWdnZXN0aW9ucyB8fFxuICAgICAgICBzZWFyY2hBc1lvdVR5cGUpICYmIHtcbiAgICAgICAgZGVib3VuY2U6IGRlYm91bmNlTGVuZ3RoIHx8IDIwMFxuICAgICAgfSksXG4gICAgICBzaG91bGRDbGVhckZpbHRlcnMsXG4gICAgICByZWZyZXNoOiAhIXNlYXJjaEFzWW91VHlwZSxcbiAgICAgIGF1dG9jb21wbGV0ZVJlc3VsdHM6ICEhYXV0b2NvbXBsZXRlUmVzdWx0cyxcbiAgICAgIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zOiAhIWF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zXG4gICAgfTtcblxuICAgIHNldFNlYXJjaFRlcm0odmFsdWUsIG9wdGlvbnMpO1xuICB9O1xuXG4gIGhhbmRsZU5vdGlmeUF1dG9jb21wbGV0ZVNlbGVjdGVkID0gc2VsZWN0aW9uID0+IHtcbiAgICBjb25zdCB7IGF1dG9jb21wbGV0ZVJlc3VsdHMsIHRyYWNrQXV0b2NvbXBsZXRlQ2xpY2tUaHJvdWdoIH0gPSB0aGlzLnByb3BzO1xuICAgIC8vIEJlY2F1c2Ugc3VnZ2VzdGlvbnMgZG9uJ3QgY291bnQgYXMgY2xpY2t0aHJvdWdocywgb25seVxuICAgIC8vIHJlc3VsdHNcbiAgICBpZiAoXG4gICAgICBhdXRvY29tcGxldGVSZXN1bHRzICYmXG4gICAgICBhdXRvY29tcGxldGVSZXN1bHRzLnNob3VsZFRyYWNrQ2xpY2tUaHJvdWdoICE9PSBmYWxzZSAmJlxuICAgICAgIXNlbGVjdGlvbi5zdWdnZXN0aW9uXG4gICAgKSB7XG4gICAgICBjb25zdCB7IGNsaWNrVGhyb3VnaFRhZ3MgPSBbXSB9ID0gYXV0b2NvbXBsZXRlUmVzdWx0cztcbiAgICAgIGNvbnN0IGlkID0gc2VsZWN0aW9uLmlkLnJhdztcbiAgICAgIHRyYWNrQXV0b2NvbXBsZXRlQ2xpY2tUaHJvdWdoKGlkLCBjbGlja1Rocm91Z2hUYWdzKTtcbiAgICB9XG4gIH07XG5cbiAgZGVmYXVsdE9uU2VsZWN0QXV0b2NvbXBsZXRlID0gc2VsZWN0aW9uID0+IHtcbiAgICBpZiAoIXNlbGVjdGlvbikgcmV0dXJuO1xuXG4gICAgY29uc3QgeyBhdXRvY29tcGxldGVSZXN1bHRzIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgdGhpcy5oYW5kbGVOb3RpZnlBdXRvY29tcGxldGVTZWxlY3RlZChzZWxlY3Rpb24pO1xuICAgIGlmICghc2VsZWN0aW9uLnN1Z2dlc3Rpb24pIHtcbiAgICAgIGNvbnN0IHVybCA9IHNlbGVjdGlvblthdXRvY29tcGxldGVSZXN1bHRzLnVybEZpZWxkXVxuICAgICAgICA/IHNlbGVjdGlvblthdXRvY29tcGxldGVSZXN1bHRzLnVybEZpZWxkXS5yYXdcbiAgICAgICAgOiBcIlwiO1xuICAgICAgaWYgKHVybCkge1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBhdXRvY29tcGxldGVSZXN1bHRzLmxpbmtUYXJnZXQgfHwgXCJfc2VsZlwiO1xuICAgICAgICB3aW5kb3cub3Blbih1cmwsIHRhcmdldCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY29tcGxldGVTdWdnZXN0aW9uKHNlbGVjdGlvbi5zdWdnZXN0aW9uKTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaXNGb2N1c2VkIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHtcbiAgICAgIGF1dG9jb21wbGV0ZU1pbmltdW1DaGFyYWN0ZXJzLFxuICAgICAgYXV0b2NvbXBsZXRlUmVzdWx0cyxcbiAgICAgIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zLFxuICAgICAgYXV0b2NvbXBsZXRlZFJlc3VsdHMsXG4gICAgICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnMsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBhdXRvY29tcGxldGVWaWV3LFxuICAgICAgaW5wdXRQcm9wcyxcbiAgICAgIGlucHV0VmlldyxcbiAgICAgIG9uU2VsZWN0QXV0b2NvbXBsZXRlLFxuICAgICAgb25TdWJtaXQsXG4gICAgICBzZWFyY2hUZXJtLFxuICAgICAgdmlldyxcbiAgICAgIC4uLnJlc3RcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGNvbnN0IFZpZXcgPSB2aWV3IHx8IFNlYXJjaEJveDtcbiAgICBjb25zdCB1c2VBdXRvY29tcGxldGUgPVxuICAgICAgKCEhYXV0b2NvbXBsZXRlUmVzdWx0cyB8fCAhIWF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zKSAmJlxuICAgICAgc2VhcmNoVGVybS5sZW5ndGggPj0gYXV0b2NvbXBsZXRlTWluaW11bUNoYXJhY3RlcnM7XG4gICAgY29uc3QgYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zQ291bnQgPSBPYmplY3QuZW50cmllcyhcbiAgICAgIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgKS5yZWR1Y2UoKGFjYywgW18sIHZhbHVlXSkgPT4gYWNjICsgdmFsdWUubGVuZ3RoLCAwKTtcbiAgICBjb25zdCBhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCA9XG4gICAgICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNDb3VudCArIGF1dG9jb21wbGV0ZWRSZXN1bHRzLmxlbmd0aDtcblxuICAgIGxldCBoYW5kbGVPblNlbGVjdEF1dG9jb21wbGV0ZTtcbiAgICBpZiAob25TZWxlY3RBdXRvY29tcGxldGUpIHtcbiAgICAgIGhhbmRsZU9uU2VsZWN0QXV0b2NvbXBsZXRlID0gc2VsZWN0aW9uID0+IHtcbiAgICAgICAgb25TZWxlY3RBdXRvY29tcGxldGUoXG4gICAgICAgICAgc2VsZWN0aW9uLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5vdGlmeUF1dG9jb21wbGV0ZVNlbGVjdGVkOiB0aGlzLmhhbmRsZU5vdGlmeUF1dG9jb21wbGV0ZVNlbGVjdGVkLFxuICAgICAgICAgICAgY29tcGxldGVTdWdnZXN0aW9uOiB0aGlzLmNvbXBsZXRlU3VnZ2VzdGlvbixcbiAgICAgICAgICAgIGF1dG9jb21wbGV0ZVJlc3VsdHM6IHRoaXMucHJvcHMuYXV0b2NvbXBsZXRlUmVzdWx0c1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhpcy5kZWZhdWx0T25TZWxlY3RBdXRvY29tcGxldGVcbiAgICAgICAgKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3Qgdmlld1Byb3BzID0ge1xuICAgICAgYWxsQXV0b2NvbXBsZXRlZEl0ZW1zQ291bnQ6IGFsbEF1dG9jb21wbGV0ZWRJdGVtc0NvdW50LFxuICAgICAgYXV0b2NvbXBsZXRlVmlldyxcbiAgICAgIGF1dG9jb21wbGV0ZVJlc3VsdHM6IGF1dG9jb21wbGV0ZVJlc3VsdHMsXG4gICAgICBhdXRvY29tcGxldGVTdWdnZXN0aW9uczogYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMsXG4gICAgICBhdXRvY29tcGxldGVkUmVzdWx0czogYXV0b2NvbXBsZXRlZFJlc3VsdHMsXG4gICAgICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnM6IGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc0NvdW50OiBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNDb3VudCxcbiAgICAgIGNvbXBsZXRlU3VnZ2VzdGlvbjogdGhpcy5jb21wbGV0ZVN1Z2dlc3Rpb24sXG4gICAgICBpc0ZvY3VzZWQ6IGlzRm9jdXNlZCxcbiAgICAgIG5vdGlmeUF1dG9jb21wbGV0ZVNlbGVjdGVkOiB0aGlzLmhhbmRsZU5vdGlmeUF1dG9jb21wbGV0ZVNlbGVjdGVkLFxuICAgICAgb25DaGFuZ2U6IHZhbHVlID0+IHRoaXMuaGFuZGxlQ2hhbmdlKHZhbHVlKSxcbiAgICAgIG9uU2VsZWN0QXV0b2NvbXBsZXRlOlxuICAgICAgICBoYW5kbGVPblNlbGVjdEF1dG9jb21wbGV0ZSB8fCB0aGlzLmRlZmF1bHRPblNlbGVjdEF1dG9jb21wbGV0ZSxcbiAgICAgIG9uU3VibWl0OiBvblN1Ym1pdFxuICAgICAgICA/IGUgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgb25TdWJtaXQoc2VhcmNoVGVybSk7XG4gICAgICAgICAgfVxuICAgICAgICA6IHRoaXMuaGFuZGxlU3VibWl0LFxuICAgICAgdXNlQXV0b2NvbXBsZXRlOiB1c2VBdXRvY29tcGxldGUsXG4gICAgICB2YWx1ZTogc2VhcmNoVGVybSxcbiAgICAgIGlucHV0UHJvcHM6IHtcbiAgICAgICAgb25Gb2N1czogdGhpcy5oYW5kbGVGb2N1cyxcbiAgICAgICAgb25CbHVyOiB0aGlzLmhhbmRsZUJsdXIsXG4gICAgICAgIC4uLmlucHV0UHJvcHNcbiAgICAgIH0sXG4gICAgICBpbnB1dFZpZXcsXG4gICAgICAuLi5yZXN0XG4gICAgfTtcblxuICAgIHJldHVybiA8VmlldyB7Li4udmlld1Byb3BzfSAvPjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB3aXRoU2VhcmNoKFxuICAoe1xuICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzLFxuICAgIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyxcbiAgICBzZWFyY2hUZXJtLFxuICAgIHNldFNlYXJjaFRlcm0sXG4gICAgdHJhY2tBdXRvY29tcGxldGVDbGlja1Rocm91Z2hcbiAgfSkgPT4gKHtcbiAgICBhdXRvY29tcGxldGVkUmVzdWx0cyxcbiAgICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnMsXG4gICAgc2VhcmNoVGVybSxcbiAgICBzZXRTZWFyY2hUZXJtLFxuICAgIHRyYWNrQXV0b2NvbXBsZXRlQ2xpY2tUaHJvdWdoXG4gIH0pXG4pKFNlYXJjaEJveENvbnRhaW5lcik7XG4iXX0=